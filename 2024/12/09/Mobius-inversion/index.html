<!DOCTYPE html><html><head><meta charset="utf-8"><title>Möbius inversion | Andimeo&#39;s Blog</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="description" content="从哪里发现的这个东西我都已经忘了，已经折腾了半个月了。今天写个总结。 Mobius inversion是一个有关 arithmetic function, multiplicative function 的定理。可以参阅 Berkeley 的一篇文章，可能是教学手稿。 它的数学表达是，若有 $$ f(n) &#x3D; \sum_{d|n} g(d) $$ 则， $$ g(n) &#x3D; \sum_{d|n} \"><meta property="og:type" content="article"><meta property="og:title" content="Möbius inversion"><meta property="og:url" content="https://andimeo.us.kg/2024/12/09/Mobius-inversion/index.html"><meta property="og:site_name" content="Andimeo&#39;s Blog"><meta property="og:description" content="从哪里发现的这个东西我都已经忘了，已经折腾了半个月了。今天写个总结。 Mobius inversion是一个有关 arithmetic function, multiplicative function 的定理。可以参阅 Berkeley 的一篇文章，可能是教学手稿。 它的数学表达是，若有 $$ f(n) &#x3D; \sum_{d|n} g(d) $$ 则， $$ g(n) &#x3D; \sum_{d|n} \"><meta property="og:locale"><meta property="article:published_time" content="2024-12-09T15:28:40.000Z"><meta property="article:modified_time" content="2024-12-26T08:14:34.979Z"><meta property="article:author" content="Andimeo"><meta property="article:tag" content="Math"><meta property="article:tag" content="Number Theory"><meta property="article:tag" content="Mobius Inversion"><meta property="article:tag" content="Dirichlet Convolution"><meta name="twitter:card" content="summary"><link rel="alternative" href="/atom.xml" title="Andimeo&#39;s Blog" type="application/atom+xml"><link rel="icon" href="/favicon.ico"><link href="http://fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="stylesheet" href="/css/bootstrap.min.css"><link rel="stylesheet" href="/css/style.css"><!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]--><meta name="generator" content="Hexo 7.3.0"></head><body><div id="container"><div id="wrap"><nav id="main-nav" class="navbar navbar-inverse navbar-fixed-top" role="navigation"><div class="container"><button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse"><span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></button> <a class="navbar-brand" href="/">Andimeo&#39;s Blog</a><div class="collapse navbar-collapse nav-menu"><ul class="nav navbar-nav"><li><a href="/archives/"><i class="fa fa-archive"></i> Archives</a></li><li><a href="/categories/"><i class="fa fa-folder"></i> Categories</a></li><li><a href="/tags/"><i class="fa fa-tags"></i> Tags</a></li><li><a href="/about/"><i class="fa fa-user"></i> About</a></li></ul><ul class="nav navbar-nav navbar-right"><li><a id="rss-link" href="/atom.xml" title="RSS Feed"><i class="fa fa-rss"></i></a></li></ul></div></div></nav><div class="clearfix"></div><div id="content" class="container"><div class="page-header-wrapper"><!--[if lt IE 9]><div class="alert alert-warning alert-dismissable"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button><strong>提示:</strong>您的浏览器版本太低了,建议升级到 <strong><a target="_blank" rel="noopener" href="http://windows.microsoft.com/zh-cn/internet-explorer/download-ie" title="IE9">IE9</a></strong> 以上,本站使用<a target="_blank" rel="noopener" href="https://www.google.com/intl/zh-CN/chrome/">Chrome浏览器</a>可以获得最好的显示效果.</div><![endif]--><div class="page-header"><h1 class="title">Möbius inversion</h1></div></div><section id="main"><article id="post-cm5521umq000l0wy73853g1h6" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-inner"><div class="article-entry" itemprop="articleBody"><div id="toc"><span class="toc-header">Contents</span><ol class="article-toc"><li class="article-toc-item article-toc-level-2"><a class="article-toc-link" href="#%E6%A6%82%E5%BF%B5"><span class="article-toc-text">概念</span></a></li><li class="article-toc-item article-toc-level-2"><a class="article-toc-link" href="#%E8%AF%81%E6%98%8E"><span class="article-toc-text">证明</span></a></li><li class="article-toc-item article-toc-level-2"><a class="article-toc-link" href="#%E5%9F%BA%E7%A1%80%E4%B9%A0%E9%A2%98"><span class="article-toc-text">基础习题</span></a><ol class="article-toc-child"><li class="article-toc-item article-toc-level-3"><a class="article-toc-link" href="#mobius-multiplications"><span class="article-toc-text">Mobius Multiplications</span></a></li><li class="article-toc-item article-toc-level-3"><a class="article-toc-link" href="#coprime-triples"><span class="article-toc-text">Coprime Triples</span></a></li><li class="article-toc-item article-toc-level-3"><a class="article-toc-link" href="#expected-greatest-common-divisor"><span class="article-toc-text">Expected Greatest Common Divisor</span></a></li><li class="article-toc-item article-toc-level-3"><a class="article-toc-link" href="#simple-sum"><span class="article-toc-text">Simple Sum</span></a></li><li class="article-toc-item article-toc-level-3"><a class="article-toc-link" href="#same-gcds"><span class="article-toc-text">Same GCDs</span></a></li><li class="article-toc-item article-toc-level-3"><a class="article-toc-link" href="#two-divisors"><span class="article-toc-text">Two Divisors</span></a></li><li class="article-toc-item article-toc-level-3"><a class="article-toc-link" href="#the-number-of-pairs"><span class="article-toc-text">The Number of Pairs</span></a></li><li class="article-toc-item article-toc-level-3"><a class="article-toc-link" href="#mike-and-foam"><span class="article-toc-text">Mike and Foam</span></a></li><li class="article-toc-item article-toc-level-3"><a class="article-toc-link" href="#unusual-sequences"><span class="article-toc-text">Unusual Sequences</span></a></li><li class="article-toc-item article-toc-level-3"><a class="article-toc-link" href="#hyperrectangle-gcd"><span class="article-toc-text">Hyperrectangle GCD</span></a></li><li class="article-toc-item article-toc-level-3"><a class="article-toc-link" href="#sky-code"><span class="article-toc-text">Sky Code</span></a></li><li class="article-toc-item article-toc-level-3"><a class="article-toc-link" href="#gcd"><span class="article-toc-text">GCD</span></a></li><li class="article-toc-item article-toc-level-3"><a class="article-toc-link" href="#gcdex---gcd-extreme"><span class="article-toc-text">GCDEX - GCD Extreme</span></a></li><li class="article-toc-item article-toc-level-3"><a class="article-toc-link" href="#lcmsum---lcm-sum"><span class="article-toc-text">LCMSUM - LCM Sum</span></a></li></ol></li><li class="article-toc-item article-toc-level-2"><a class="article-toc-link" href="#dirichlet-convolution"><span class="article-toc-text">Dirichlet convolution</span></a><ol class="article-toc-child"><li class="article-toc-item article-toc-level-3"><a class="article-toc-link" href="#%E6%9D%9C%E6%95%99%E7%AD%9B"><span class="article-toc-text">杜教筛</span></a></li><li class="article-toc-item article-toc-level-3"><a class="article-toc-link" href="#function"><span class="article-toc-text">function</span></a></li><li class="article-toc-item article-toc-level-3"><a class="article-toc-link" href="#adding-least-common-multiples"><span class="article-toc-text">Adding Least Common Multiples</span></a></li></ol></li><li class="article-toc-item article-toc-level-2"><a class="article-toc-link" href="#more-advanced-problems"><span class="article-toc-text">More advanced problems</span></a></li></ol></div><p>从哪里发现的这个东西我都已经忘了，已经折腾了半个月了。今天写个总结。</p><p>Mobius inversion是一个有关 arithmetic function, multiplicative function 的定理。可以参阅 Berkeley 的一篇<a target="_blank" rel="noopener" href="https://math.berkeley.edu/~stankova/MathCircle/Multiplicative.pdf">文章</a>，可能是教学手稿。</p><p>它的数学表达是，若有 $$ f(n) = \sum_{d|n} g(d) $$ 则， $$ g(n) = \sum_{d|n} \mu(d)f(\frac{n}{d}) $$</p><p>其中，$\mu(n)$ 是 Mobius function，它的取值为， $$\mu(n)=\begin{cases} 1 &amp; \text{if }n = 1 \\ 0 &amp; \text{if }n \text{ is not square-free} \\ (-1)^r &amp; \text{if }n = p_1p_2\cdots p_r \text{- distinct primes}\end{cases}$$</p><p>接下来，我会针对文章中的一些习题作出相应证明，主要是为了描述解决这类问题的时候的一种思路。然后会提供一些相关的题目，并附上推导过程以及代码。</p><span id="more"></span><h2 id="概念">概念</h2><ul><li><strong>Multiplicative function</strong></li></ul><p>An arithmetic function $f(n)$ is multiplicative if for any relatively prime $n, m \in \mathbb{N}$: $ f(nm) = f(n)f(m) $</p><ul><li><strong>Well-known multiplicative functions</strong></li></ul><p>$\mu(n)\text{, the Mobius function}$</p><p>$e(n)=\begin{cases}1 &amp; \text{ if }n = 1\\0 &amp; \text{ otherwise }\end{cases}\text{, the Dirichlet identity function}$</p><p>$I(n)=1\text{, for all }n \in \mathbb{N}$</p><p>$id(n)=n\text{, for all }n \in \mathbb{N}$</p><ul><li><strong>Common functions on divisors</strong></li></ul><p>$\tau(n) = \text{the number of all natural divisors of n}$</p><p>$\sigma(n) = \text{the sum of all natural divisors of n}$</p><p>$\pi(n) = \text{the product of all natural divisors of n}$</p><p>If we write the prime decomposition of $n$ as $n = p_1^{\alpha_1}p_2^{\alpha_2}\cdots p_r^{\alpha_r}$, then</p><p>$\tau(n) = \prod_{i=1}^r (\alpha_i + 1)$</p><p>$\sigma(n) = \prod_{i=1}^r \frac{p_i^{\alpha_i + 1} - 1}{p_i - 1}$</p><p>$\pi(n) = n^{\frac{1}{2}\tau(n)}$</p><ul><li><strong>Sum-function</strong></li></ul><p>Define $ S_f(n) = \sum_{d|n} f(d) $ to be the sum-function of $f(n)$. If $f(n)$ is multiplicative, then $S_f(n)$ is also multiplicative.</p><p>We have $S_{\mu} = e$, $S_e = I$, $S_I = \tau$, and $S_{id} = \sigma$.</p><h2 id="证明">证明</h2><p><strong>1. Define $\sigma_k(n) = \sum_{d|n} d^k$. Thus, $\sigma_0(n) = \tau(n)$ and $\sigma_1(n) = \sigma_(n)$. Prove that $\sigma_k(n)$ is multiplicative for all $k \in \mathbb{N}$, and find a formula for it.</strong></p><p>Proof:</p><p>Say $n = \prod_{i=1}^r p_{a_i}^{\alpha_i}$, and $m = \prod_{i=1}^s p_{b_i}^{\beta_i}$. Then</p><p>$ \sigma_k(n\cdot m) = \sum_{i_1=0}^{\alpha_1}{p_{a_1}^{i_1\cdot k}} \sum_{i_2=0}^{\alpha_2}{p_{a_2}^{i_2\cdot k}} \cdots \sum_{i_r=0}^{\alpha_r}{p_{a_r}^{i_r\cdot k}} \sum_{j_1=0}^{\beta_1}{p_{b_1}^{j_1\cdot k}} \sum_{j_2=0}^{\beta_2}{p_{b_2}^{j_2\cdot k}} \cdots \sum_{j_s=0}^{\beta_s}{p_{b_s}^{j_s\cdot k}} $</p><p>Since every $\prod_{i=1}^r {p_{a_i}^{x_i}\prod_{j=1}^s {p_{b_j}^{y_j}}}$ is a divisor of $n\cdot m$.</p><p>Then, notice that,</p><p>$ \sigma_k(n) = \sum_{i_1=0}^{\alpha_1}{p_{a_1}^{i_1\cdot k}} \sum_{i_2=0}^{\alpha_2}{p_{a_2}^{i_2\cdot k}} \cdots \sum_{i_r=0}^{\alpha_r}{p_{a_r}^{i_r\cdot k}} $</p><p>$ \sigma_k(m) = \sum_{j_1=0}^{\beta_1}{p_{b_1}^{j_1\cdot k}} \sum_{j_2=0}^{\beta_2}{p_{b_2}^{j_2\cdot k}} \cdots \sum_{j_s=0}^{\beta_s}{p_{b_s}^{j_s\cdot k}} $</p><p>So we have that,</p><p>$ \sigma_k(n\cdot m) = \sigma_k(n)\sigma_k(m) $</p><p>Q.E.D.</p><p>And</p><p>$ \sigma_k(n) = \prod_{i=1}^r \frac{p_i^{(\alpha_i+1)\cdot k} - 1}{p_i^k - 1} $</p><p><strong>2. If $f(n)$ is multiplicative, $f \not\equiv 0$, then show $\sum_{d|n}\mu(d)f(d) = \prod_{i=1}^r(1 - f(p_i))$.</strong></p><p>Proof:</p><p>Since $f(n)$ is multiplicative, we have $f(ab) = f(a)f(b)$ if a and b are coprime. For a divisor $d$ of $n$ which is not square-free, $\mu(d) = 0$. So we only care about square-free divisors. Therefore,</p><p>$$ \sum_{d|n}\mu(d)f(d) = \sum_{e_1=0}^1\sum_{e_2=0}^1\cdots\sum_{e_r=0}^1 \mu(p_1^{e_1}p_2^{e_2}\cdots p_r^{e_r})f(p_1^{e_1}p_2^{e_2}\cdots p_r^{e_r}) $$</p><p>Due to the multiplicativeness of $\mu$ and $f$, we have,</p><p>$$ \sum_{d|n}\mu(d)f(d) = \sum_{e_1=0}^1\mu(p_1^{e_1})f(p_1^{e_1})\sum_{e_2=0}^1\mu(p_2^{e_2})f(p_2^{e_2})\cdots \sum_{e_r=0}^1\mu(p_r^{e_r})f(p_r^{e_r}) $$</p><p>When $e_i = 0$, $\mu(p_i^{e_i}) = 1$. When $e_i = 1$, $\mu(p_i^{e_i}) = -1$. So,</p><p>$$ \sum_{d|n}\mu(d)f(d) = (1-f(p_1))(1-f(p_2))\cdots(1-f(p_r)) $$ $$ \sum_{d|n}\mu(d)f(d) = \prod_{i=1}^r(1 - f(p_i)) $$</p><p>Q.E.D.</p><p><strong>3. The <em>sum-function</em> $S_{\varphi}(n)$ of the Euler function $\varphi(n)$ satisfies:</strong> $$ \sum_{d|n}\varphi(d) = n $$</p><p>Proof:</p><p>$\varphi(n)$ is multiplicative, so $S_{\varphi}(n)$ is also multiplicative. Therefore, $$ \begin{split} S_{\varphi}(n) &amp; = S_{\varphi}(p_1^{\alpha_1}p_2^{\alpha_2}\cdots p_r^{\alpha_r}) \\ &amp; = S_{\varphi}(p_1^{\alpha_1})S_{\varphi}(p_2^{\alpha_2})\cdots S_{\varphi}(p_r^{\alpha_r}) \\ \end{split}$$</p><p>Since $\varphi(p_i^{\alpha_i}) = p_i^{\alpha_i} - p_i^{\alpha_i-1}$, we have $S_{\varphi}(p_i^{\alpha_i}) = p_i^{\alpha_i}$</p><p>Therefore, $S_{\varphi}(n) = S_{\varphi}(p_1^{\alpha_1})S_{\varphi}(p_2^{\alpha_2})\cdots S_{\varphi}(p_r^{\alpha_r}) = p_1^{\alpha_1}p_2^{\alpha_2}\cdots p_r^{\alpha_r} = n$</p><p>Q.E.D.</p><h2 id="基础习题">基础习题</h2><p>以下题目基本都总结于于下面的 Tutorial 中，</p><ul><li><a target="_blank" rel="noopener" href="https://codeforces.com/blog/entry/54090">Linear sieve</a></li><li><a target="_blank" rel="noopener" href="https://discuss.codechef.com/t/a-dance-with-mobius-function/11315">A dance with mobius function</a></li><li><a target="_blank" rel="noopener" href="https://codeforces.com/blog/entry/53925">Mobius inversion</a></li><li><a target="_blank" rel="noopener" href="https://codeforces.com/blog/entry/54150">[Tutorial] Math note — Dirichlet convolution</a></li><li><a target="_blank" rel="noopener" href="https://codeforces.com/blog/entry/117635">Dirichlet convolution. Part 1: Fast prefix sum computations</a></li><li><a target="_blank" rel="noopener" href="https://codeforces.com/blog/entry/117783">Dirichlet convolution. Part 2: Dirichlet series and prime counting</a></li><li><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/solution/P4213">杜教筛</a></li><li><a target="_blank" rel="noopener" href="https://earthshakira.github.io/a2oj-clientside/server/Category669.html">Mobius Function problems</a></li></ul><h3 id="mobius-multiplications">Mobius Multiplications</h3><p><a target="_blank" rel="noopener" href="https://www.codechef.com/problems/ENCODE07?tab=statement">Problem</a></p><p>Given N, find the number of tuples (a,b) with 1&lt;=a&lt;=N and 1&lt;=b&lt;=N, such that $\mu(a\cdot b) = \mu(a) \cdot \mu(b)$.</p><p>经过简单分析，若$\mu(a) = 0$ 或 $\mu(b) = 0$，则$a\cdot b$仍然是 non-square-free 的，所以左边右边都为0。满足要求。</p><p>当$\mu(a) \neq 0$ 且 $\mu(b) \neq 0$ 时，</p><p>若 $a$ 与 $b$ 是互素的：</p><ol><li>若 $a$ 与 $b$ 都只有奇数个素因子，则左边和右边都等于1。满足要求。</li><li>若 $a$ 与 $b$ 都只有偶数个素因子，则左边和右边都等于1。满足要求。</li><li>若 $a$ 与 $b$ 一个有奇数个素因子，一个有偶数个素因子，则左边和右边都等于-1。满足要求。</li></ol><p>若 $a$ 与 $b$ 不互素时，$a\cdot b$ 是 non-square-free 的，所以左右为0，而右边为1 或 -1，不满足要求。</p><p>故而题目转化为求： $$\sum_{a=1}^N\sum_{b=1}^N [\mu(a) \neq 0][\mu(b) \neq 0][gcd(a, b) \neq 1]$$</p><p>上式等于: $$\sum_{a=1}^N[\mu(a) \neq 0]\sum_{b=1}^N[\mu(b) \neq 0] - \sum_{a=1}^N[\mu(a) \neq 0]\sum_{b=1}^N[\mu(b) \neq 0][gcd(a, b) = 1]$$</p><p>其中: $$\begin{split} \sum_{a=1}^N[\mu(a) \neq 0]\sum_{b=1}^N[\mu(b) \neq 0][gcd(a, b) = 1] &amp; = \sum_{a=1}^N[\mu(a) \neq 0]\sum_{b=1}^N[\mu(b) \neq 0]\sum_{d|gcd(a, b)}\mu(d) \\ &amp; = \sum_{d=1}^N\mu(d)\sum_{a=1}^N[\mu(a) \neq 0][d | a]\sum_{b=1}^N[\mu(b) \neq 0][d | b] \\ \end{split}$$</p><p>因为 $N &lt;= 10^5$，所以我们可以直接针对每个 $d$ 进行计算。令 $cnt[d] = \sum_{a=1}^N[\mu(a) \neq 0][d | a]$, $sz = \sum_{a=1}^N[\mu(a) \neq 0]$，则不满足要求的数量为 $s = sz^2 - \sum_{d=1}^N\mu(d)cnt[d]^2$。答案为 $N^2 - s$。</p><p>提前筛法求 $\mu$ 复杂度为 O(NlogN)，求 $cnt[1...N]$ 的复杂度也为 $O(NlogN)$。所以最终复杂度即 $O(NlogN)$。</p><details><summary><u style="color:Tomato"><b>Solution</b></u></summary><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> all(x) x.begin(),x.end()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> pb push_back</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> tc int tt, qq = 0; cin &gt;&gt; tt; while(qq++ &lt; tt)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> cs cout &lt;&lt; <span class="string">&quot;Case &quot;</span> &lt;&lt; qq &lt;&lt; <span class="string">&quot;: &quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> INF 1000000000000000000LL <span class="comment">// Never use 1e(s) mara khawa sure, mone rakhba :)</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> speed ios_base::sync_with_stdio(0); cin.tie(0); cout.tie(0);</span></span><br><span class="line"><span class="function">mt19937_64 <span class="title">rng</span><span class="params">(chrono::steady_clock::now().time_since_epoch().count())</span></span>;</span><br><span class="line"><span class="keyword">using</span> <span class="type">hash_t</span> = <span class="type">uint64_t</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">100004</span>;</span><br><span class="line"><span class="type">int</span> mu[N], mind[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">precompute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; N; i++) mu[i] = <span class="number">-1</span>, mind[i] = i;</span><br><span class="line">    mu[<span class="number">1</span>] = <span class="number">1</span>; mind[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt; N; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (mind[i] == i) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = i; j &lt; N; j += i) &#123;</span><br><span class="line">                <span class="keyword">if</span> (mind[j] == j) mind[j] = i;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (mind[i / mind[i]] == mind[i]) mu[i] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">else</span> mu[i] = mu[i / mind[i]] * mu[mind[i]];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> n; cin &gt;&gt; n;</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">cnt</span><span class="params">(n + <span class="number">1</span>, <span class="number">0</span>)</span></span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = i; j &lt;= n; j += i) &#123;</span><br><span class="line">            cnt[i] += (mu[j] != <span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> v = <span class="number">0</span>, sz = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        v += mu[i] * cnt[i] * cnt[i];</span><br><span class="line">        sz += mu[i] != <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    v = sz * sz - v;</span><br><span class="line">    cout &lt;&lt; n * n - v &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">speed</span></span><br><span class="line"><span class="function">    <span class="title">precompute</span><span class="params">()</span></span>;</span><br><span class="line">    tc &#123;</span><br><span class="line">        <span class="built_in">solve</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></details><h3 id="coprime-triples">Coprime Triples</h3><p><a target="_blank" rel="noopener" href="https://www.codechef.com/problems/COPRIME3?tab=statement">Problem</a></p><p>You are given a sequence $a_1, a_2, ..., a_N$. Count the number of triples $(i, j, k)$ such that $1 ≤ i &lt; j &lt; k ≤ N$ and $GCD(a_i, a_j, a_k) = 1$. Here GCD stands for the Greatest Common Divisor.</p><p>这个题目是要求:</p><p>$$\begin{split} \sum_{i=1}^N\sum_{j=i+1}^N\sum_{k=j+1}^N [\gcd(a_i, a_j, a_k) = 1] &amp; = \sum_{i=1}^N\sum_{j=i+1}^N\sum_{k=j+1}^N\sum_{d|gcd(a_i, a_j, a_k)}\mu(d) \\ &amp; = \sum_{d=1}^N\mu(d)\sum_{i=1}^N[d|a_i]\sum_{j=i+1}^N[d|a_j]\sum_{k=j+1}^N[d|a_k] \\ \end{split}$$</p><p>而 $\sum_{i=1}^N[d|a_i]\sum_{j=i+1}^N[d|a_j]\sum_{k=j+1}^N[d|a_k]$ 即为原数组中等于 $d$ 的倍数的元素中任取三个的组合数。所以 $O(NlogN)$ 得解。</p><details><summary><u style="color:Tomato"><b>Solution</b></u></summary><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> all(x) x.begin(),x.end()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> pb push_back</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> tc int tt, qq = 0; cin &gt;&gt; tt; while(qq++ &lt; tt)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> cs cout &lt;&lt; <span class="string">&quot;Case &quot;</span> &lt;&lt; qq &lt;&lt; <span class="string">&quot;: &quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> INF 1000000000000000000LL <span class="comment">// Never use 1e(s) mara khawa sure, mone rakhba :)</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> speed ios_base::sync_with_stdio(0); cin.tie(0); cout.tie(0);</span></span><br><span class="line"><span class="function">mt19937_64 <span class="title">rng</span><span class="params">(chrono::steady_clock::now().time_since_epoch().count())</span></span>;</span><br><span class="line"><span class="keyword">using</span> <span class="type">hash_t</span> = <span class="type">uint64_t</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1000000</span> + <span class="number">1</span>;</span><br><span class="line"><span class="type">int</span> mu[N], mind[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">precompute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; N; i++) mu[i] = <span class="number">-1</span>, mind[i] = <span class="number">-1</span>;</span><br><span class="line">    mu[<span class="number">1</span>] = mind[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt; N; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (mind[i] == <span class="number">-1</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = i; j &lt; N; j += i) &#123;</span><br><span class="line">                <span class="keyword">if</span> (mind[j] == <span class="number">-1</span>) mind[j] = i;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (mind[i] == i) mu[i] = <span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (mind[i / mind[i]] == mind[i]) mu[i] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">else</span> mu[i] = mu[i / mind[i]] * mu[mind[i]];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">C3</span><span class="params">(<span class="type">int</span> m)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> m * (m - <span class="number">1</span>) * (m - <span class="number">2</span>) / <span class="number">6</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> cnt[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> n; cin &gt;&gt; n;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="type">int</span> x; cin &gt;&gt; x; cnt[x]++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; N; i++) &#123;</span><br><span class="line">        <span class="type">int</span> x = mu[i], m = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = i; j &lt; N; j += i) &#123;</span><br><span class="line">            m += cnt[j];</span><br><span class="line">        &#125;</span><br><span class="line">        ans += x * <span class="built_in">C3</span>(m);</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; ans &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">speed</span></span><br><span class="line"><span class="function">    <span class="title">precompute</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">// tc &#123;</span></span><br><span class="line">        <span class="built_in">solve</span>();</span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></details><h3 id="expected-greatest-common-divisor">Expected Greatest Common Divisor</h3><p><a target="_blank" rel="noopener" href="https://www.codechef.com/problems/EXGCD?tab=statement">Problem</a></p><p>给定 $A_1, A2, ..., A_k$ 和 $B_1, B_2, ..., B_k$，其中 $k &lt;= 5$，令 $a_i$ 在 $[A_i, B_i]$ 中随机取值，问 $gcd(a_1, a_2, ..., a_k)$ 的期望值。</p><p>因为 $a_i$ 在 $[A_i, B_i]$ 中随机分布，所以其实我们是求 $P / Q$，其中： $$ \begin{split} P &amp; = \sum_{a_1=A_1}^{B_1}\sum_{a_2=A_2}^{B_2}\cdots\sum_{a_k=A_k}^{B_k} gcd(a_1, a_2, ..., a_k) \\ Q &amp; = \prod_{i=1}^k (B_i - A_i + 1) \\ \end{split}$$</p><p>所以直接计算 $P$， $$ \begin{split} P &amp; = \sum_{a_1=A_1}^{B_1}\sum_{a_2=A_2}^{B_2}\cdots\sum_{a_k=A_k}^{B_k} \sum_{d=1}^Nd \cdot [gcd(a_1, a_2, ..., a_k) = d] \\ &amp; = \sum_{d=1}^Nd\sum_{a_1=A_1/d}^{B_1/d}\sum_{a_2=A_2/d}^{B_2/d}\cdots\sum_{a_k=A_k/d}^{B_k/d} [gcd(a_1, a_2, ..., a_k) = 1] \\ &amp; = \sum_{d=1}^Nd\sum_{a_1=A_1/d}^{B_1/d}\sum_{a_2=A_2/d}^{B_2/d}\cdots\sum_{a_k=A_k/d}^{B_k/d}\sum_{k|gcd(a_1, a_2, ..., a_k)} \mu(k) \\ &amp; = \sum_{d=1}^Nd\sum_{k=1}^N\mu(k)\sum_{a_1=A_1/d}^{B_1/d}[k|a_1]\sum_{a_2=A_2/d}^{B_2/d}[k|a_2]\cdots\sum_{a_k=A_k/d}^{B_k/d}[k|a_k] \\ &amp; = \sum_{d=1}^Nd\sum_{k=1}^N\mu(k)\sum_{a_1=A_1/dk}^{B_1/dk}\sum_{a_2=A_2/dk}^{B_2/dk}\cdots\sum_{a_k=A_k/dk}^{B_k/dk} 1 \\ &amp; = \sum_{d=1}^Nd\sum_{k=1}^N\mu(k)\prod_{i=1}^k(\frac{B_i}{dk} - \frac{A_i}{dk} + 1) \\ \end{split}$$</p><p>令 $l = dk$， $$ \begin{split} P &amp; = \sum_{d=1}^Nd\sum_{k=1}^N\mu(k)\prod_{i=1}^k(\frac{B_i}{l} - \frac{A_i}{l} + 1) \\ &amp; = \sum_{l=1}^N\prod_{i=1}^k(\frac{B_i}{l} - \frac{A_i}{l} + 1)\sum_{k|l}\mu(k)\frac{l}{k} \end{split}$$</p><p>令 $g(l) = \sum_{k|l}\mu(k)\frac{l}{k}$，可知 $g(p^k) = p^k - p^{k-1}$，所以实际上 $g(l)$ 即 Euler&#39;s totient function，即 $\varphi(n)$。</p><p>所以最终， $$ P = \sum_{l=1}^N\varphi(l)\prod_{i=1}^k(\frac{B_i}{l} - \frac{A_i}{l} + 1) $$。</p><p>提前筛法求 $\varphi(n)$复杂度为 $O(NlogN)$，然后 $O(N)$ 可得 $P$。故总复杂度为 $O(NlogN)$，其中 $N$ 为 $B_i$ 的最小值。</p><details><summary><u style="color:Tomato"><b>Solution</b></u></summary><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> all(x) x.begin(),x.end()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> pb push_back</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> tc int tt, qq = 0; cin &gt;&gt; tt; while(qq++ &lt; tt)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> cs cout &lt;&lt; <span class="string">&quot;Case &quot;</span> &lt;&lt; qq &lt;&lt; <span class="string">&quot;: &quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> INF 1000000000000000000LL <span class="comment">// Never use 1e(s) mara khawa sure, mone rakhba :)</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> speed ios_base::sync_with_stdio(0); cin.tie(0); cout.tie(0);</span></span><br><span class="line"><span class="function">mt19937_64 <span class="title">rng</span><span class="params">(chrono::steady_clock::now().time_since_epoch().count())</span></span>;</span><br><span class="line"><span class="keyword">using</span> <span class="type">hash_t</span> = <span class="type">uint64_t</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">200004</span>, MOD = <span class="number">1000000007</span>;</span><br><span class="line"><span class="type">int</span> phi[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">precompute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; N; i++) phi[i] = i;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt; N; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (phi[i] == i) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = i; j &lt; N; j += i) &#123;</span><br><span class="line">                phi[j] -= phi[j] / i;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">pow</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (n == <span class="number">0</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> b = <span class="built_in">pow</span>(a, n / <span class="number">2</span>);</span><br><span class="line">    b = b * b % MOD;</span><br><span class="line">    <span class="keyword">if</span> (n % <span class="number">2</span> == <span class="number">1</span>) b = b * a % MOD;</span><br><span class="line">    <span class="keyword">return</span> b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">inv</span><span class="params">(<span class="type">int</span> a)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">pow</span>(a, MOD - <span class="number">2</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> k; cin &gt;&gt; k;</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">A</span><span class="params">(k)</span>, <span class="title">B</span><span class="params">(k)</span></span>;</span><br><span class="line">    <span class="type">int</span> minB = N;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; k; i++) cin &gt;&gt; A[i] &gt;&gt; B[i], minB = <span class="built_in">min</span>(minB, B[i]);</span><br><span class="line">    <span class="type">int</span> ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> l = <span class="number">1</span>; l &lt;= minB; l++) &#123;</span><br><span class="line">        <span class="type">int</span> v = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; k; j++) &#123;</span><br><span class="line">            <span class="type">int</span> upper = B[j] / l, lower = (A[j] + l - <span class="number">1</span>) / l;</span><br><span class="line">            v = v * (upper - lower + <span class="number">1</span>) % MOD;</span><br><span class="line">        &#125;</span><br><span class="line">        ans = (ans + v * phi[l] % MOD) % MOD;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// requirement: P / Q, find N that (P + Q * N) % MOD = 0</span></span><br><span class="line">    <span class="comment">// so N = -P / Q (MOD N)</span></span><br><span class="line">    ans = MOD - ans;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; k; i++) &#123;</span><br><span class="line">        ans = ans * <span class="built_in">inv</span>(B[i] - A[i] + <span class="number">1</span>) % MOD;</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; ans &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">speed</span></span><br><span class="line"><span class="function">    <span class="title">precompute</span><span class="params">()</span></span>;</span><br><span class="line">    tc &#123;</span><br><span class="line">        <span class="built_in">solve</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></details><h3 id="simple-sum">Simple Sum</h3><p><a target="_blank" rel="noopener" href="https://www.codechef.com/problems/SMPLSUM?tab=statement">Problem</a></p><p>Given $n$，find $\sum_{i=1}^n \frac{n}{gcd(i, n)}$.</p><p>我们有： $$\begin{split} \sum_{i=1}^n \frac{n}{gcd(i, n)} &amp; = \sum_{i=1}^n \sum_{d|n} \frac{n}{d}[gcd(i, n) = d] \\ &amp; = \sum_{d|n}\frac{n}{d}\sum_{i=1}^n[gcd(i, n) = d] \\ &amp; = \sum_{d|n}\frac{n}{d}\sum_{i=1}^{n/d}[gcd(i, n) = 1] \\ &amp; = \sum_{d|n}\frac{n}{d}\varphi(\frac{n}{d}) \\ &amp; = \sum_{d|n}d \cdot \varphi(d) \\ \end{split}$$</p><p>所以事实上，我们已经可以以 $O(NlogN)$ 的复杂度计算出结果了。 但是这道题目 $N &lt;= 10^7$，而且卡常数，所以我们必须要更快才可以。</p><p>我们令 $n = k \cdot p^e$，其中 $p$ 为 $n$ 的某个素因子，$k$ 为 $n$ 除尽 $p$ 之后的值。则有： $$ \begin{split} \sum_{d|n}d\varphi(d) &amp; = \sum_{\alpha=0}^e\sum_{d|k}dp^{\alpha}\varphi(dp^{\alpha}) \\ &amp; = \sum_{\alpha=0}^ep^{\alpha}\varphi(p^{\alpha})\sum_{d|k}d\varphi(d) \\ \end{split}$$</p><p>其中第一项为： $$ \begin{split} \sum_{\alpha=0}^ep^{\alpha}\varphi(p^{\alpha}) &amp; = 1 + \sum_{\alpha=1}^ep^{\alpha}p^{\alpha-1}(p - 1) \\ &amp; = 1 + \sum_{\alpha=1}^ep^{2\alpha} - \sum_{\alpha=1}^ep^{2\alpha-1} \\ &amp; = \sum_{\alpha=0}^ep^{2\alpha} - \sum_{\alpha=0}^{e-1}p^{2\alpha+1} \\ &amp; = \frac{p^{2(e+1)}-1}{p^2-1} - p\frac{p^{2e}-1}{p^2-1} \\ &amp; = \frac{p^{2e+1}+1}{p+1} \\ &amp; = p^{2e} - \frac{p^{2e}-1}{p+1} \\ \end{split}$$</p><p>所以最终答案为: $$ \begin{split} \sum_{d|n}d\varphi(d) = \prod_{p|n}(p^{2e} - \frac{p^{2e}-1}{p+1}) \\ \end{split}$$</p><p>当我们用筛法求出 $n$ 的最小素因子后，可以以 $O(logN)$ 的复杂度算出答案。</p><details><summary><u style="color:Tomato"><b>Solution</b></u></summary><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="comment">// #define int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> all(x) x.begin(),x.end()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> pb push_back</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> tc int tt, qq = 0; cin &gt;&gt; tt; while(qq++ &lt; tt)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> cs cout &lt;&lt; <span class="string">&quot;Case &quot;</span> &lt;&lt; qq &lt;&lt; <span class="string">&quot;: &quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> INF 1000000000000000000LL <span class="comment">// Never use 1e(s) mara khawa sure, mone rakhba :)</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> speed ios_base::sync_with_stdio(0); cin.tie(0); cout.tie(0);</span></span><br><span class="line"><span class="function">mt19937_64 <span class="title">rng</span><span class="params">(chrono::steady_clock::now().time_since_epoch().count())</span></span>;</span><br><span class="line"><span class="keyword">using</span> <span class="type">hash_t</span> = <span class="type">uint64_t</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">10000001</span>;</span><br><span class="line"><span class="type">int</span> mind[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">precompute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; N; i++) mind[i] = <span class="number">-1</span>;</span><br><span class="line">    mind[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt; N; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (mind[i] == <span class="number">-1</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = i; j &lt; N; j += i) &#123;</span><br><span class="line">                <span class="keyword">if</span> (mind[j] == <span class="number">-1</span>) mind[j] = i;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> n; cin &gt;&gt; n;</span><br><span class="line">    <span class="type">long</span> <span class="type">long</span> ans = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (n &gt; <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="type">int</span> p = mind[n];</span><br><span class="line">        <span class="type">int</span> ppw = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (n % p == <span class="number">0</span>) &#123;</span><br><span class="line">            ppw *= p;</span><br><span class="line">            n /= p;</span><br><span class="line">        &#125;</span><br><span class="line">        ans *= (<span class="number">1LL</span> * ppw * ppw - (<span class="number">1LL</span> * ppw * ppw - <span class="number">1</span>) / (p + <span class="number">1</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; ans &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">speed</span></span><br><span class="line"><span class="function">    <span class="title">precompute</span><span class="params">()</span></span>;</span><br><span class="line">    tc &#123;</span><br><span class="line">        <span class="built_in">solve</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></details><h3 id="same-gcds">Same GCDs</h3><p><a target="_blank" rel="noopener" href="https://codeforces.com/contest/1295/problem/D">Problem</a></p><p>Given $a$ and $m$, find the number of $0 &lt;= x &lt; m$ such that $gcd(a, m) = gcd(a + x, m)$。</p><p>令 $d = gcd(a, m)$, 因为 $d | a$ 且 $d | m$，所以 $d | x$。然后令 $m&#39; = m / d$, $a&#39; = a / d$，$x&#39; = x / d$，则所求为: $$\sum_{x&#39;=0}^{m&#39;-1}[gcd(a&#39; + x&#39;, m&#39;) = 1]$$</p><p>令 $y = a&#39; + x&#39;$，则上式为: $$\begin{split} \sum_{y=a&#39;}^{a&#39;+m&#39;-1}[gcd(y, m&#39;) = 1] &amp; = \sum_{y=a&#39;}^{m&#39;}[gcd(y, m&#39;) = 1] + \sum_{y=m&#39;+1}^{a&#39;+m&#39;-1}[gcd(y, m&#39;) = 1] \\ &amp; = \sum_{y=a&#39;}^{m&#39;}[gcd(y, m&#39;) = 1] + \sum_{y=1}^{a&#39;-1}[gcd(y, m&#39;) = 1] \\ &amp; = \sum_{y=1}^{m&#39;}[gcd(y, m&#39;) = 1] = \varphi(m&#39;) \\ \end{split}$$</p><details><summary><u style="color:Tomato"><b>Solution</b></u></summary><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> all(x) x.begin(),x.end()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> pb push_back</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> tc int tt, qq = 0; cin &gt;&gt; tt; while(qq++ &lt; tt)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> cs cout &lt;&lt; <span class="string">&quot;Case &quot;</span> &lt;&lt; qq &lt;&lt; <span class="string">&quot;: &quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> INF 1000000000000000000LL <span class="comment">// Never use 1e(s) mara khawa sure, mone rakhba :)</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> speed ios_base::sync_with_stdio(0); cin.tie(0); cout.tie(0);</span></span><br><span class="line"><span class="function">mt19937_64 <span class="title">rng</span><span class="params">(chrono::steady_clock::now().time_since_epoch().count())</span></span>;</span><br><span class="line"><span class="keyword">using</span> <span class="type">hash_t</span> = <span class="type">uint64_t</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">gcd</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> b == <span class="number">0</span> ? a : <span class="built_in">gcd</span>(b, a % b);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">100000</span> + <span class="number">5</span>;</span><br><span class="line">vector&lt;<span class="type">int</span>&gt; primes;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">precompute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">sieve</span><span class="params">(N, <span class="number">1</span>)</span></span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt; N; i++) &#123;</span><br><span class="line">       <span class="keyword">if</span> (sieve[i]) &#123;</span><br><span class="line">            primes.<span class="built_in">pb</span>(i);</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = i * i; j &lt; N; j += i) sieve[j] = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> a, m; cin &gt;&gt; a &gt;&gt; m;</span><br><span class="line">    <span class="type">int</span> d = <span class="built_in">gcd</span>(a, m);</span><br><span class="line">    <span class="type">int</span> A = a / d, B = m / d;</span><br><span class="line">    <span class="type">int</span> phi = B;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> v : primes) &#123;</span><br><span class="line">        <span class="keyword">if</span> (v &gt; B) <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">if</span> (B % v == <span class="number">0</span>) &#123;</span><br><span class="line">            phi -= phi / v;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> (B % v == <span class="number">0</span>) B /= v;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (B &gt; <span class="number">1</span>) phi -= phi / B;</span><br><span class="line">    cout &lt;&lt; phi &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">speed</span></span><br><span class="line"><span class="function">    <span class="title">precompute</span><span class="params">()</span></span>;</span><br><span class="line">    tc &#123;</span><br><span class="line">        <span class="built_in">solve2</span>();</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></details><h3 id="two-divisors">Two Divisors</h3><p><a target="_blank" rel="noopener" href="https://codeforces.com/contest/1366/problem/D">Problem</a></p><p>You are given $n$ integers $a_1, a_2, ..., a_n$. For each $a_i$, find its two divisors $d_1 &gt; 1$ and $d_2 &gt; 1$ such that $gcd(d_1 + d_2, a_i) = 1$.</p><p>这个题目没什么意思，若 $a_i$ 只有一个素因子，那么 $gcd(d_1 + d_2, a_i) \neq 1$，所以若 $a_i$ 含有两个或两个以上的素因子，这两个素因子就满足条件。</p><details><summary><u style="color:Tomato"><b>Solution</b></u></summary><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> all(x) x.begin(),x.end()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> pb push_back</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> tc int tt, qq = 0; cin &gt;&gt; tt; while(qq++ &lt; tt)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> cs cout &lt;&lt; <span class="string">&quot;Case &quot;</span> &lt;&lt; qq &lt;&lt; <span class="string">&quot;: &quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> INF 1000000000000000000LL <span class="comment">// Never use 1e(s) mara khawa sure, mone rakhba :)</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> speed ios_base::sync_with_stdio(0); cin.tie(0); cout.tie(0);</span></span><br><span class="line"><span class="function">mt19937_64 <span class="title">rng</span><span class="params">(chrono::steady_clock::now().time_since_epoch().count())</span></span>;</span><br><span class="line"><span class="keyword">using</span> <span class="type">hash_t</span> = <span class="type">uint64_t</span>;</span><br><span class="line"></span><br><span class="line">vector&lt;<span class="type">int</span>&gt; mind;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">pf</span><span class="params">(<span class="type">int</span> N)</span> </span>&#123;</span><br><span class="line">    mind.<span class="built_in">assign</span>(N, <span class="number">-1</span>);</span><br><span class="line">    mind[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt; N; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (mind[i] == <span class="number">-1</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = i; j &lt; N; j += i) &#123;</span><br><span class="line">                <span class="keyword">if</span> (mind[j] == <span class="number">-1</span>) mind[j] = i;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> n; cin &gt;&gt; n;</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">a</span><span class="params">(n)</span></span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) cin &gt;&gt; a[i];</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">d1</span><span class="params">(n)</span>, <span class="title">d2</span><span class="params">(n)</span></span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        d1[i] = mind[a[i]];</span><br><span class="line">        d2[i] = a[i];</span><br><span class="line">        <span class="keyword">while</span> (d2[i] % d1[i] == <span class="number">0</span>) d2[i] /= d1[i];</span><br><span class="line">        <span class="keyword">if</span> (d2[i] == <span class="number">1</span>) &#123;</span><br><span class="line">            d1[i] = d2[i] = <span class="number">-1</span>;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) cout &lt;&lt; d1[i] &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">    cout &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) cout &lt;&lt; d2[i] &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">    cout &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">speed</span></span><br><span class="line"><span class="function">    <span class="title">pf</span><span class="params">(<span class="number">10000001</span>)</span></span>;</span><br><span class="line">    <span class="comment">// tc &#123;</span></span><br><span class="line">        <span class="built_in">solve</span>();</span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></details><h3 id="the-number-of-pairs">The Number of Pairs</h3><p><a target="_blank" rel="noopener" href="https://codeforces.com/contest/1499/problem/D">Problem</a></p><p>You are given three positive integers $c$, $d$, and $x$. You have to find the number of pairs of positive integers $(a, b)$ such that the equality $c \cdot lcm(a, b) - d \cdot gcd(a, b) = x$ holds.</p><p>令 $k = gcd(a, b)$, 则 $a = pk$, $b = qk$，且 $gcd(p, q) = 1$。 原式即为： $$ \begin{split} c \cdot \frac{pk \cdot qk}{k} - dk &amp; = x \\ (cpq - d)k &amp; = x \\ \end{split}$$</p><p>所以我们可以枚举 $x$ 的所有因子 $y$，保留 $c | (y + d)$ 的那些，然后就是求有多少对互素的 $p, q$，满足 $pq = \frac{y + d}{c}$。 只需要拿到 $\frac{y + d}{c}$ 的所有素因子，假设其有 $n$ 个素因子，答案即为 $2^n$。</p><details><summary><u style="color:Tomato"><b>Solution</b></u></summary><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> all(x) x.begin(),x.end()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> pb push_back</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> tc int tt, qq = 0; cin &gt;&gt; tt; while(qq++ &lt; tt)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> cs cout &lt;&lt; <span class="string">&quot;Case &quot;</span> &lt;&lt; qq &lt;&lt; <span class="string">&quot;: &quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> INF 1000000000000000000LL <span class="comment">// Never use 1e(s) mara khawa sure, mone rakhba :)</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> speed ios_base::sync_with_stdio(0); cin.tie(0); cout.tie(0);</span></span><br><span class="line"><span class="function">mt19937_64 <span class="title">rng</span><span class="params">(chrono::steady_clock::now().time_since_epoch().count())</span></span>;</span><br><span class="line"><span class="keyword">using</span> <span class="type">hash_t</span> = <span class="type">uint64_t</span>;</span><br><span class="line"></span><br><span class="line">vector&lt;<span class="type">int</span>&gt; primeDivisors;</span><br><span class="line"></span><br><span class="line"><span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">classicSieve</span><span class="params">(<span class="type">int</span> N)</span> </span>&#123;</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">vals</span><span class="params">(N, <span class="number">0</span>)</span>, <span class="title">mind</span><span class="params">(N, <span class="number">-1</span>)</span></span>;</span><br><span class="line">    mind[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">2</span>; i &lt; N; i++)</span><br><span class="line">        <span class="keyword">if</span>(mind[i] == <span class="number">-1</span>)</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j = i; j &lt; N; j += i)</span><br><span class="line">                <span class="keyword">if</span> (mind[j] == <span class="number">-1</span>) mind[j] = i;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt; N; i++) &#123;</span><br><span class="line">        <span class="type">int</span> j = i / mind[i];</span><br><span class="line">        vals[i] = vals[j] + (mind[i] != mind[j]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> vals;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> c, d, x; cin &gt;&gt; c &gt;&gt; d &gt;&gt; x;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; divisors;</span><br><span class="line">    <span class="type">int</span> i = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(i * i &lt;= x) &#123;</span><br><span class="line">        <span class="keyword">if</span>(x % i == <span class="number">0</span>) &#123;</span><br><span class="line">            divisors.<span class="built_in">pb</span>(i);</span><br><span class="line">            <span class="keyword">if</span>(i != x / i) divisors.<span class="built_in">pb</span>(x / i);</span><br><span class="line">        &#125;</span><br><span class="line">        i++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> g : divisors) &#123;</span><br><span class="line">        <span class="keyword">if</span> ((x / g + d) % c != <span class="number">0</span>) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="type">int</span> k = (x / g + d) / c;</span><br><span class="line">        ans += (<span class="number">1LL</span> &lt;&lt; primeDivisors[k]);</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; ans &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    speed</span><br><span class="line">    primeDivisors = <span class="built_in">classicSieve</span>(<span class="number">20000001</span>);</span><br><span class="line">    tc &#123;</span><br><span class="line">        <span class="built_in">solve</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></details><h3 id="mike-and-foam">Mike and Foam</h3><p><a target="_blank" rel="noopener" href="https://codeforces.com/contest/547/problem/C">Problem</a></p><p>Given $n$ numbers, initially a sequence is empty. For each query $i$, if $a_i$ is in the sequence, remove it, otherwise add it. After each query, find how many pairs of numbers in the sequence are coprime.</p><p>这其实是 COPRIME3 的简单版本，只不过可选的数字会变化。</p><p>$$\begin{split} \sum_{i=1}^n\sum_{j=i+1}^n[gcd(a_i, a_j) = 1] &amp; = \sum_{i=1}^n\sum_{j=i+1}^n\sum_{d|gcd(a_i, a_j)}\mu(d) \\ &amp; = \sum_{d=1}^N\mu(d)\sum_{i=1}^n[d|a_i]\sum_{j=i+1}^n[d|a_j] \\ \end{split}$$</p><p>其中 $\sum_{i=1}^n[d|a_i]\sum_{j=i+1}^n[d|a_j]$ 即为从原数组中能够被 $d$ 整除的元素中取两个的组合数。</p><p>每添加一个数或减去一个数，只要更新这个数的所有因子对应的部分的值即可。另外别忘了更新 $cnt[d]$。</p><details><summary><u style="color:Tomato"><b>Solution</b></u></summary><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> all(x) x.begin(),x.end()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> pb push_back</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> tc int tt, qq = 0; cin &gt;&gt; tt; while(qq++ &lt; tt)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> cs cout &lt;&lt; <span class="string">&quot;Case &quot;</span> &lt;&lt; qq &lt;&lt; <span class="string">&quot;: &quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> INF 1000000000000000000LL <span class="comment">// Never use 1e(s) mara khawa sure, mone rakhba :)</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> speed ios_base::sync_with_stdio(0); cin.tie(0); cout.tie(0);</span></span><br><span class="line"><span class="function">mt19937_64 <span class="title">rng</span><span class="params">(chrono::steady_clock::now().time_since_epoch().count())</span></span>;</span><br><span class="line"><span class="keyword">using</span> <span class="type">hash_t</span> = <span class="type">uint64_t</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">500001</span>;</span><br><span class="line"><span class="type">int</span> mind[N], mu[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">precompute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; N; i++) mind[i] = <span class="number">-1</span>, mu[i] = <span class="number">-1</span>;</span><br><span class="line">    mind[<span class="number">1</span>] = <span class="number">1</span>, mu[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt; N; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (mind[i] == <span class="number">-1</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = i; j &lt; N; j += i) &#123;</span><br><span class="line">                <span class="keyword">if</span> (mind[j] == <span class="number">-1</span>) mind[j] = i;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (mind[i / mind[i]] == mind[i]) mu[i] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">else</span> mu[i] = mu[i / mind[i]] * mu[mind[i]];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> n, q; cin &gt;&gt; n &gt;&gt; q;</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">cnt</span><span class="params">(N, <span class="number">0</span>)</span>, <span class="title">a</span><span class="params">(n)</span>, <span class="title">b</span><span class="params">(n, <span class="number">0</span>)</span></span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) cin &gt;&gt; a[i];</span><br><span class="line">    <span class="type">int</span> ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (q--) &#123;</span><br><span class="line">        <span class="type">int</span> x; cin &gt;&gt; x; x--;</span><br><span class="line">        <span class="keyword">if</span> (b[x] == <span class="number">0</span>) &#123;</span><br><span class="line">            b[x] = <span class="number">1</span>;</span><br><span class="line">            <span class="type">int</span> d = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">while</span> (d * d &lt;= a[x]) &#123;</span><br><span class="line">                <span class="keyword">if</span> (a[x] % d == <span class="number">0</span>) &#123;</span><br><span class="line">                    ans += mu[d] * cnt[d];</span><br><span class="line">                    cnt[d]++;</span><br><span class="line">                    <span class="type">int</span> p = a[x] / d;</span><br><span class="line">                    <span class="keyword">if</span> (p != d) &#123;</span><br><span class="line">                        ans += mu[p] * cnt[p];</span><br><span class="line">                        cnt[p]++;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                d++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            b[x] = <span class="number">0</span>;</span><br><span class="line">            <span class="type">int</span> d = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">while</span> (d * d &lt;= a[x]) &#123;</span><br><span class="line">                <span class="keyword">if</span> (a[x] % d == <span class="number">0</span>) &#123;</span><br><span class="line">                    cnt[d]--;</span><br><span class="line">                    ans -= mu[d] * cnt[d];</span><br><span class="line">                    <span class="type">int</span> p = a[x] / d;</span><br><span class="line">                    <span class="keyword">if</span> (p != d) &#123;</span><br><span class="line">                        cnt[p]--;</span><br><span class="line">                        ans -= mu[p] * cnt[p];</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                d++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        cout &lt;&lt; ans &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">speed</span></span><br><span class="line"><span class="function">    <span class="title">precompute</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">// tc &#123;</span></span><br><span class="line">        <span class="built_in">solve</span>();</span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></details><h3 id="unusual-sequences">Unusual Sequences</h3><p><a target="_blank" rel="noopener" href="https://codeforces.com/contest/900/problem/D">Problem</a></p><p>Count the number of distinct sequences $a_1, a_2, ..., a_n$ consisting of positive integers such that $gcd(a_1, a_2, \cdots, a_n) = x$ and $\sum_{i=1}^n a_i = y$.</p><p>题目要求:</p><p>$$\begin{split} &amp; \sum_{a_1=1}\sum_{a_2=1}\cdots\sum_{a_n=1}[gcd(a_1, a_2, \cdots, a_n) = x][\sum_{i=1}^n a_i = y] \\ &amp; = \sum_{a_1=1}\sum_{a_2=1}\cdots\sum_{a_n=1}[gcd(a_1, a_2, \cdots, a_n) = 1][\sum_{i=1}^n a_i = \frac{y}{x}] \\ &amp; = \sum_{d=1}\mu(d)\sum_{a_1=1}[d|a_1]\sum_{a_2=1}[d|a_2]\cdots\sum_{a_n=1}[d|a_n][\sum_{i=1}^n a_i = \frac{y}{x}] \\ &amp; = \sum_{d=1}\mu(d)\sum_{a_1=1}\sum_{a_2=1} \cdots \sum_{a_n=1}[\sum_{i=1}^n a_i = \frac{y}{d \cdot x}] \\ \end{split}$$</p><p>所以首先 $x | y$，否则答案为 0。对于 $\frac{y}{x}$ 的每个因子 $d$，我们只要找到有多少个序列的和等于 $\frac{y}{dx}$，就可以得到答案。 令 $z = \frac{y}{dx}$，则只有一个元素的序列个数为 ${z-1} \choose {0}$, 有两个元素的序列个数为 ${z-1} \choose {1}$, 因为要求 $a_i &gt; 0$，所以序列长度最多为 $z$，其序列个数为 ${z-1} \choose {z-1}$。 所以答案为 $2^{z-1}$。</p><details><summary><u style="color:Tomato"><b>Solution</b></u></summary><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> all(x) x.begin(),x.end()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> pb push_back</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> tc int tt, qq = 0; cin &gt;&gt; tt; while(qq++ &lt; tt)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> cs cout &lt;&lt; <span class="string">&quot;Case &quot;</span> &lt;&lt; qq &lt;&lt; <span class="string">&quot;: &quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> INF 1000000000000000000LL <span class="comment">// Never use 1e(s) mara khawa sure, mone rakhba :)</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> speed ios_base::sync_with_stdio(0); cin.tie(0); cout.tie(0);</span></span><br><span class="line"><span class="function">mt19937_64 <span class="title">rng</span><span class="params">(chrono::steady_clock::now().time_since_epoch().count())</span></span>;</span><br><span class="line"><span class="keyword">using</span> <span class="type">hash_t</span> = <span class="type">uint64_t</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">40004</span>, MOD = <span class="number">1000000007</span>;</span><br><span class="line"><span class="type">int</span> mind[N], mu[N];</span><br><span class="line">vector&lt;<span class="type">int</span>&gt; primes;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">bigpow</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (n == <span class="number">0</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> b = <span class="built_in">bigpow</span>(a, n / <span class="number">2</span>);</span><br><span class="line">    b = b * b  % MOD;</span><br><span class="line">    <span class="keyword">if</span> (n % <span class="number">2</span> == <span class="number">1</span>) b = b * a % MOD;</span><br><span class="line">    <span class="keyword">return</span> b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">precompute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; N; i++) mind[i] = i, mu[i] = <span class="number">-1</span>;</span><br><span class="line">    mind[<span class="number">1</span>] = mu[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt; N; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (mind[i] == i) &#123;</span><br><span class="line">            primes.<span class="built_in">pb</span>(i);</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = i; j &lt; N; j += i) &#123;</span><br><span class="line">                <span class="keyword">if</span> (mind[j] == j) mind[j] = i;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (mind[i / mind[i]] == mind[i]) mu[i] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">else</span> mu[i] = mu[i / mind[i]] * mu[mind[i]];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> x, y; cin &gt;&gt; x &gt;&gt; y;</span><br><span class="line">    <span class="keyword">if</span> (y % x != <span class="number">0</span>) &#123;</span><br><span class="line">        cout &lt;&lt; <span class="number">0</span> &lt;&lt; endl;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    y /= x;</span><br><span class="line">    function&lt;<span class="type">int</span>(<span class="type">int</span>)&gt; mu_ = [&amp;](<span class="type">int</span> v) &#123;</span><br><span class="line">        <span class="keyword">if</span> (v &lt; N) <span class="keyword">return</span> mu[v];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; primes.<span class="built_in">size</span>(); i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (v % primes[i] == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (v / primes[i] % primes[i] == <span class="number">0</span>) <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">                <span class="keyword">return</span> <span class="number">-1</span> * <span class="built_in">mu_</span>(v / primes[i]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1LL</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="type">int</span> d = <span class="number">1</span>, ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (d * d &lt;= y) &#123;</span><br><span class="line">        <span class="keyword">if</span> (y % d == <span class="number">0</span>) &#123;</span><br><span class="line">            ans = (ans + <span class="built_in">mu_</span>(d) * <span class="built_in">bigpow</span>(<span class="number">2</span>, y / d - <span class="number">1</span>) + MOD) % MOD;</span><br><span class="line">            <span class="keyword">if</span> (d != y / d) &#123;</span><br><span class="line">                ans = (ans + <span class="built_in">mu_</span>(y / d) * <span class="built_in">bigpow</span>(<span class="number">2</span>, d - <span class="number">1</span>) + MOD) % MOD;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        d++;</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; ans &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">speed</span></span><br><span class="line"><span class="function">    <span class="title">precompute</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">// tc &#123;</span></span><br><span class="line">        <span class="built_in">solve</span>();</span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></details><h3 id="hyperrectangle-gcd">Hyperrectangle GCD</h3><p><a target="_blank" rel="noopener" href="https://www.hackerrank.com/challenges/hyperrectangle-gcd/problem">Problem</a></p><p>题目就是求 $\sum_{a_1=1}^{n_1}\sum_{a_2=1}^{n_2}\cdots\sum_{a_k=1}^{n_k}gcd(a_1, a_2, \cdots, a_k)$，其中 $k &lt;=500$。</p><p>上式等于： $$\begin{split} &amp; = \sum_{d=1}^Nd\sum_{a_1=1}^{n_1}\sum_{a_2=1}^{n_2}\cdots\sum_{a_k=1}^{n_k}[gcd(a_1, a_2, \cdots, a_k) = d] \\ &amp; = \sum_{d=1}^Nd\sum_{a_1=1}^{n_1/d}\sum_{a_2=1}^{n_2/d}\cdots\sum_{a_k=1}^{n_k/d}[gcd(a_1, a_2, \cdots, a_k) = 1] \\ &amp; = \sum_{d=1}^Nd\sum_{a_1=1}^{n_1/d}\sum_{a_2=1}^{n_2/d}\cdots\sum_{a_k=1}^{n_k/d}\sum_{h|gcd(a_1, a_2, \cdots, a_k)}\mu(h) \\ &amp; = \sum_{d=1}^Nd\sum_{h=1}^N\mu(h)\sum_{a_1=1}^{n_1/d}[h|a_1]\sum_{a_2=1}^{n_2/d}[h|a_2]\cdots\sum_{a_k=1}^{n_k/d}[h|a_k] \\ &amp; = \sum_{d=1}^Nd\sum_{h=1}^N\mu(h)\prod_{i=1}^k\frac{n_i}{dh} \\ \end{split}$$</p><p>令 $l = dh$，则上式为： $$ \sum_{l=1}^N\prod_{i=1}^k\frac{n_i}{l}\sum_{h|l}\mu(h)\frac{l}{h} $$</p><p>而 $\sum_{h|l}\mu(h)\frac{l}{h}$ 即为 $\varphi(l)$。所以最终结果为： $$ \sum_{l=1}^N\varphi(l)\prod_{i=1}^k\frac{n_i}{l} $$</p><details><summary><u style="color:Tomato"><b>Solution</b></u></summary><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> all(x) x.begin(),x.end()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> pb push_back</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> tc int tt, qq = 0; cin &gt;&gt; tt; while(qq++ &lt; tt)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> cs cout &lt;&lt; <span class="string">&quot;Case &quot;</span> &lt;&lt; qq &lt;&lt; <span class="string">&quot;: &quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> INF 1000000000000000000LL <span class="comment">// Never use 1e(s) mara khawa sure, mone rakhba :)</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> speed ios_base::sync_with_stdio(0); cin.tie(0); cout.tie(0);</span></span><br><span class="line"><span class="function">mt19937_64 <span class="title">rng</span><span class="params">(chrono::steady_clock::now().time_since_epoch().count())</span></span>;</span><br><span class="line"><span class="keyword">using</span> <span class="type">hash_t</span> = <span class="type">uint64_t</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">100004</span>, MOD = <span class="number">1000000007</span>;</span><br><span class="line"><span class="type">int</span> phi[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">precompute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; N; i++) phi[i] = i;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt; N; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (phi[i] == i) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = i; j &lt; N; j += i) &#123;</span><br><span class="line">                phi[j] -= phi[j] / i;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> k; cin &gt;&gt; k;</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">B</span><span class="params">(k)</span></span>;</span><br><span class="line">    <span class="type">int</span> minB = N;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; k; i++) cin &gt;&gt; B[i], minB = <span class="built_in">min</span>(minB, B[i]);</span><br><span class="line">    <span class="type">int</span> ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> l = <span class="number">1</span>; l &lt;= minB; l++) &#123;</span><br><span class="line">        <span class="type">int</span> v = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; k; j++) &#123;</span><br><span class="line">            <span class="type">int</span> upper = B[j] / l;</span><br><span class="line">            v = v * upper % MOD;</span><br><span class="line">        &#125;</span><br><span class="line">        ans = (ans + v * phi[l] % MOD) % MOD;</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; ans &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">speed</span></span><br><span class="line"><span class="function">    <span class="title">precompute</span><span class="params">()</span></span>;</span><br><span class="line">    tc &#123;</span><br><span class="line">        <span class="built_in">solve</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></details><h3 id="sky-code">Sky Code</h3><p><a target="_blank" rel="noopener" href="http://poj.org/problem?id=3904">Problem</a></p><p>Given $n$ positive integers, find the number of quadruples such that their $gcd$ equals 1。</p><p>这个跟前面的 COPRIME3 可以说是一模一样了。</p><p>$$\begin{split} \sum_{i=1}^N\sum_{j=i+1}^N\sum_{k=j+1}^N\sum_{h=k+1}^N [\gcd(a_i, a_j, a_k, a_h) = 1] &amp; = \sum_{i=1}^N\sum_{j=i+1}^N\sum_{k=j+1}^N\sum_{h=k+1}^N\sum_{d|gcd(a_i, a_j, a_k, a_h)}\mu(d) \\ &amp; = \sum_{d=1}^N\mu(d)\sum_{i=1}^N[d|a_i]\sum_{j=i+1}^N[d|a_j]\sum_{k=j+1}^N[d|a_k]\sum_{h=k+1}^N[d|a_h] \\ \end{split}$$</p><p>其中 $\sum_{i=1}^N[d|a_i]\sum_{j=i+1}^N[d|a_j]\sum_{k=j+1}^N[d|a_k]\sum_{h=k+1}^N[d|a_h]$，令 $f(d)$ 表示序列中能被 $d$ 整除的个数，则答案即为 $f(d) \choose 4$。</p><details><summary><u style="color:Tomato"><b>Solution</b></u></summary><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> all(x) x.begin(),x.end()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> pb push_back</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> tc int tt, qq = 0; cin &gt;&gt; tt; while(qq++ &lt; tt)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> cs cout &lt;&lt; <span class="string">&quot;Case &quot;</span> &lt;&lt; qq &lt;&lt; <span class="string">&quot;: &quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> INF 1000000000000000000LL <span class="comment">// Never use 1e(s) mara khawa sure, mone rakhba :)</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> speed ios_base::sync_with_stdio(0); cin.tie(0); cout.tie(0);</span></span><br><span class="line"><span class="function">mt19937_64 <span class="title">rng</span><span class="params">(chrono::steady_clock::now().time_since_epoch().count())</span></span>;</span><br><span class="line"><span class="keyword">using</span> <span class="type">hash_t</span> = <span class="type">uint64_t</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">10000</span> + <span class="number">1</span>;</span><br><span class="line"><span class="type">int</span> mu[N], mind[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">precompute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; N; i++) mu[i] = <span class="number">-1</span>, mind[i] = <span class="number">-1</span>;</span><br><span class="line">    mu[<span class="number">1</span>] = mind[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt; N; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (mind[i] == <span class="number">-1</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = i; j &lt; N; j += i) &#123;</span><br><span class="line">                <span class="keyword">if</span> (mind[j] == <span class="number">-1</span>) mind[j] = i;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (mind[i] == i) mu[i] = <span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (mind[i / mind[i]] == mind[i]) mu[i] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">else</span> mu[i] = mu[i / mind[i]] * mu[mind[i]];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">C4</span><span class="params">(<span class="type">int</span> m)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> m * (m - <span class="number">1</span>) * (m - <span class="number">2</span>) * (m - <span class="number">3</span>) / <span class="number">24</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> cnt[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    <span class="keyword">while</span> (cin &gt;&gt; n) &#123;</span><br><span class="line">        <span class="built_in">memset</span>(cnt, <span class="number">0</span>, <span class="built_in">sizeof</span>(cnt));</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="type">int</span> x; cin &gt;&gt; x; cnt[x]++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> ans = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; N; i++) &#123;</span><br><span class="line">            <span class="type">int</span> x = mu[i], m = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = i; j &lt; N; j += i) &#123;</span><br><span class="line">                m += cnt[j];</span><br><span class="line">            &#125;</span><br><span class="line">            ans += x * <span class="built_in">C4</span>(m);</span><br><span class="line">        &#125;</span><br><span class="line">        cout &lt;&lt; ans &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">speed</span></span><br><span class="line"><span class="function">    <span class="title">precompute</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">// tc &#123;</span></span><br><span class="line">        <span class="built_in">solve</span>();</span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></details><h3 id="gcd">GCD</h3><p><a target="_blank" rel="noopener" href="https://acm.hdu.edu.cn/showproblem.php?pid=1695">Problem</a></p><p>题目要求：</p><p>$$\begin{split} &amp; \sum_{x=1}^b\sum_{y=1}^d[gcd(x, y) = k] \\ &amp; = \sum_{x=1}^{b/k}\sum_{y=1}^{d/k}[gcd(x, y) = 1] \\ &amp; = \sum_{x=1}^{b/k}\sum_{y=1}^{d/k}\sum_{h|gcd(x, y)}\mu(h) \\ &amp; = \sum_{h=1}^n\mu(h)\sum_{x=1}^{b/k}[h|x]\sum_{y=1}^{d/k}[h|y] \\ &amp; = \sum_{h=1}^{min(\frac{b}{k}, \frac{d}{k})}\mu(h)\sum_{x=1}^{b/kh}\sum_{y=1}^{d/kh} \\ &amp; = \sum_{h=1}^{min(\frac{b}{k}, \frac{d}{k})}\mu(h)\frac{b}{kh} \cdot \frac{d}{kh} \\ \end{split}$$</p><p>然后枚举计算即可。注意题目要求 $(a, b)$ 与 $(b, a)$ 算一个，所以需要去掉重复的，假设 $b &lt;= d，令，</p><p>$$p = \sum_{h=1}^{\frac{b}{k}}\mu(h)\frac{b}{kh}\frac{b}{kh}$$</p><p>则重复元素数为 $ \frac{p - 1}{2} $。因为在 $x \in [1, b], y \in [1, d]$ 中，除了 $(k, k)$ 之外，都计算了两遍。</p><p>令， $$q = \sum_{h=1}^{\frac{b}{k}}\mu(h)\frac{b}{kh}\frac{d}{kh}$$</p><p>则最终答案为：$q - \frac{p - 1}{2}$。</p><details><summary><u style="color:Tomato"><b>Solution</b></u></summary><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> all(x) x.begin(),x.end()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> pb push_back</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> tc int tt, qq = 0; cin &gt;&gt; tt; while(qq++ &lt; tt)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> cs cout &lt;&lt; <span class="string">&quot;Case &quot;</span> &lt;&lt; qq &lt;&lt; <span class="string">&quot;: &quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> INF 1000000000000000000LL <span class="comment">// Never use 1e(s) mara khawa sure, mone rakhba :)</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> speed ios_base::sync_with_stdio(0); cin.tie(0); cout.tie(0);</span></span><br><span class="line"><span class="function">mt19937_64 <span class="title">rng</span><span class="params">(chrono::steady_clock::now().time_since_epoch().count())</span></span>;</span><br><span class="line"><span class="keyword">using</span> <span class="type">hash_t</span> = <span class="type">uint64_t</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">100000</span> + <span class="number">4</span>;</span><br><span class="line"><span class="type">int</span> mu[N], mind[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">precompute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; N; i++) mu[i] = <span class="number">1</span>, mind[i] = <span class="number">-1</span>;</span><br><span class="line">    mu[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt; N; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (mind[i] == <span class="number">-1</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = i; j &lt; N; j += i) &#123;</span><br><span class="line">                <span class="keyword">if</span> (mind[j] == <span class="number">-1</span>) mind[j] = i;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (mind[i] == i) mu[i] = <span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (mind[i / mind[i]] == mind[i]) mu[i] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">else</span> mu[i] = mu[i / mind[i]] * mu[mind[i]];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">solve</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> a, b, c, d, k; cin &gt;&gt; a &gt;&gt; b &gt;&gt; c &gt;&gt; d &gt;&gt; k;</span><br><span class="line">    <span class="keyword">if</span> (k == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (b &gt; d) <span class="built_in">swap</span>(b, d);</span><br><span class="line">    <span class="type">int</span> p = <span class="number">0</span>, q = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= b / k; i++) &#123;</span><br><span class="line">        p += mu[i] * (b / i / k) * (b / i / k);</span><br><span class="line">        q += mu[i] * (b / i / k) * (d / i / k);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> q - (p - <span class="number">1</span>) / <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">speed</span></span><br><span class="line"><span class="function">    <span class="title">precompute</span><span class="params">()</span></span>;</span><br><span class="line">    tc &#123;</span><br><span class="line">        cs &lt;&lt; <span class="built_in">solve</span>() &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></details><h3 id="gcdex---gcd-extreme">GCDEX - GCD Extreme</h3><p><a target="_blank" rel="noopener" href="https://www.spoj.com/problems/GCDEX/">Problem</a></p><p>题目要求：</p><p>$$\begin{split} &amp; \sum_{i=1}^{n-1}\sum_{j=i+1}^ngcd(i, j) \\ &amp; = \sum_{d=1}^nd\sum_{i=1}^{n-1}\sum_{j=i+1}^n [gcd(i, j) = d] \\ &amp; = \sum_{d=1}^nd\sum_{i=1}^n\sum_{j=i}^n[gcd(i, j) = d] - \sum_{i=1}^ni \\ &amp; = \sum_{d=1}^nd\sum_{i=1}^{n/d}\sum_{j=i}^{n/d} [gcd(i, j) = 1] - \frac{n(n+1)}{2} \\ &amp; = \sum_{d=1}^nd\sum_{i=1}^{n/d}\sum_{j=i}^{n/d}\sum_{h|gcd(i, j)}\mu(h) - \frac{n(n+1)}{2} \\ &amp; = \sum_{d=1}^nd\sum_{h=1}^n\mu(h)\sum_{i=1}^{n/d}[h|i]\sum_{j=i}^{n/d}[h|j] - \frac{n(n+1)}{2} \\ &amp; = \sum_{d=1}^nd\sum_{h=1}^n\mu(h)\sum_{i=1}^{n/dh}\sum_{j=i}^{n/dh} - \frac{n(n+1)}{2} \\ &amp; = \sum_{d=1}^nd\sum_{h=1}^n\mu(h)\dbinom{n/dh + 1}{2} - \frac{n(n+1)}{2} \\ \end{split}$$</p><p>令 $l = dh$，则上式为： $$ \sum_{l=1}^n\dbinom{n/l+1}{2}\sum_{h|l}\mu(h)\frac{l}{h} $$</p><p>其中 $\sum_{h|l}\mu(h)\frac{l}{h}$ 即为 $\varphi(l)$。所以最终结果为： $$ \sum_{l=1}^n\varphi(l)\dbinom{n/l+1}{2} $$</p><p>根据上式我们可以使用分段的方法，在 $O(\sqrt{n})$ 的时间内算出答案。 但是仍然无法通过本题的评测。</p><p>我们需要另外一种推导， $$ \begin{split} &amp; \sum_{i=1}^{n-1}\sum_{j=i+1}^ngcd(i, j) \\ &amp; = \sum_{i=1}^n\sum_{j=1}^{i-1}gcd(i, j) \\ &amp; = \sum_{i=1}^n\sum_{d|i}d\sum_{j=1}^{i-1}[gcd(i, j) = d] \\ &amp; = \sum_{i=1}^n（\sum_{d|i}d\sum_{j=1}^i[gcd(i, j) = d]）- i \\ &amp; = \sum_{i=1}^n（\sum_{d|i}d(\sum_{j=1}^{i/d}[gcd(\frac{i}{d}, j) = 1]）- i \\ &amp; = \sum_{i=1}^n（\sum_{d|i}d(\varphi(\frac{i}{d})）- i \\ \end{split}$$</p><p>这样我们就可以使用筛法加前缀和，提前在 $O(nlogn)$ 的时间内算出所有值，然后针对每个输入，在 $O(1)$ 的时间内得到答案。</p><details><summary><u style="color:Tomato"><b>Solution</b></u></summary><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> all(x) x.begin(),x.end()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> pb push_back</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> tc int tt, qq = 0; cin &gt;&gt; tt; while(qq++ &lt; tt)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> cs cout &lt;&lt; <span class="string">&quot;Case &quot;</span> &lt;&lt; qq &lt;&lt; <span class="string">&quot;: &quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> INF 1000000000000000000LL <span class="comment">// Never use 1e(s) mara khawa sure, mone rakhba :)</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> speed ios_base::sync_with_stdio(0); cin.tie(0); cout.tie(0);</span></span><br><span class="line"><span class="function">mt19937_64 <span class="title">rng</span><span class="params">(chrono::steady_clock::now().time_since_epoch().count())</span></span>;</span><br><span class="line"><span class="keyword">using</span> <span class="type">hash_t</span> = <span class="type">uint64_t</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1000001</span>;</span><br><span class="line"><span class="type">int</span> phi[N];</span><br><span class="line"><span class="type">int</span> f[N], g[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">precompute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; N; i++) phi[i] = i, g[i] = <span class="number">0</span>, f[i] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt; N; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (phi[i] == i) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = i; j &lt; N; j += i) &#123;</span><br><span class="line">                phi[j] -= phi[j] / i;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; N; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = i; j &lt; N; j += i) &#123;</span><br><span class="line">            g[j] += i * phi[j / i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; N; i++) &#123;</span><br><span class="line">        f[i] = f[i<span class="number">-1</span>] + g[i] - i;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    <span class="keyword">while</span> (cin &gt;&gt; n &amp;&amp; n) &#123;</span><br><span class="line">        cout &lt;&lt; f[n] &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">speed</span></span><br><span class="line"><span class="function">    <span class="title">precompute</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">// tc &#123;</span></span><br><span class="line">        <span class="built_in">solve</span>();</span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></details><h3 id="lcmsum---lcm-sum">LCMSUM - LCM Sum</h3><p><a target="_blank" rel="noopener" href="https://www.spoj.com/problems/LCMSUM/">Problem</a></p><p>题目要求：</p><p>$$\begin{split} \sum_{i=1}^nlcm(i, n) &amp; = \sum_{i=1}^n\frac{i \cdot n}{gcd(i, n)} \\ &amp; = \sum_{d|n}\sum_{i=1}^n\frac{i \cdot n}{d}[gcd(i, n) = d] \\ &amp; = \sum_{d|n}\sum_{i=1}^{n/d}\frac{i \cdot d \cdot n}{d}[gcd(i, \frac{n}{d}) = 1] \\ &amp; = n\sum_{d|n}\sum_{i=1}^{n/d}i\sum_{h|\frac{n}{d}}\mu(h)[h|i] \\ &amp; = n\sum_{d|n}\sum_{h|\frac{n}{d}}\mu(h)\sum_{i=1}^{n/d}i[h|i] \\ &amp; = n\sum_{d|n}\sum_{h|\frac{n}{d}}\mu(h)h\sum_{i=1}^{\frac{n}{dh}}i \\ &amp; = n\sum_{d|n}\sum_{h|\frac{n}{d}}\mu(h)h\frac{(\frac{n}{dh} + 1)\frac{n}{dh})}{2} \\ \end{split}$$</p><p>令， $$\begin{split} &amp; g(n) = \sum_{h|n}\mu(h)h\frac{(\frac{n}{h} + 1)\frac{n}{h}}{2} \\ &amp; f(n) = \sum_{d|n}g(\frac{n}{d}) = \sum_{d|n}g(d) \\ \end{split}$$</p><p>则最终答案为：$n\cdot f(n)$。且$g$ 与 $f$ 都可以在 $O(nlogn)$ 的时间内通过筛法算出。</p><details><summary><u style="color:Tomato"><b>Solution</b></u></summary><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> all(x) x.begin(),x.end()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> pb push_back</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> tc int tt, qq = 0; cin &gt;&gt; tt; while(qq++ &lt; tt)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> cs cout &lt;&lt; <span class="string">&quot;Case &quot;</span> &lt;&lt; qq &lt;&lt; <span class="string">&quot;: &quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> INF 1000000000000000000LL <span class="comment">// Never use 1e(s) mara khawa sure, mone rakhba :)</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> speed ios_base::sync_with_stdio(0); cin.tie(0); cout.tie(0);</span></span><br><span class="line"><span class="function">mt19937_64 <span class="title">rng</span><span class="params">(chrono::steady_clock::now().time_since_epoch().count())</span></span>;</span><br><span class="line"><span class="keyword">using</span> <span class="type">hash_t</span> = <span class="type">uint64_t</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1000004</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> mind[N], mu[N], f[N], g[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">precompute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt; N; i++) mind[i] = mu[i] = <span class="number">-1</span>, f[i] = g[i] = <span class="number">0</span>;</span><br><span class="line">    mind[<span class="number">1</span>] = mu[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">2</span>; i &lt; N; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (mind[i] == <span class="number">-1</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = i; j &lt; N; j += i) &#123;</span><br><span class="line">                <span class="keyword">if</span> (mind[j] == <span class="number">-1</span>) mind[j] = i;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (mind[i / mind[i]] == mind[i]) mu[i] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">else</span> mu[i] = mu[i / mind[i]] * mu[mind[i]];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; N; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = i; j &lt; N; j += i) &#123;</span><br><span class="line">            <span class="type">int</span> v = (j / i + <span class="number">1</span>) * (j / i) / <span class="number">2</span>;</span><br><span class="line">            g[j] += mu[i] * i * v;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; N; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = i; j &lt; N; j += i) &#123;</span><br><span class="line">            f[j] += g[i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> n; cin &gt;&gt; n;</span><br><span class="line">    cout &lt;&lt; f[n] * n &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">speed</span></span><br><span class="line"><span class="function">    <span class="title">precompute</span><span class="params">()</span></span>;</span><br><span class="line">    tc &#123;</span><br><span class="line">        <span class="built_in">solve</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></details><h2 id="dirichlet-convolution">Dirichlet convolution</h2><p>设 $f$ 和 $g$ 是两个arithmetic function，它们的Dirichlet convolution是: $(f \star g)(n) = \sum_{d|n} f(d) g(\frac{n}{d})$。 Dirichlet convolution满足交换性，结合性。单位元为函数 $\epsilon(n) = \begin{cases}1 &amp; \text{if } n = 1 \\ 0 &amp; \text {otherwise}\end{cases}$。即 $f \star \epsilon = f$。</p><p>由Dirichlet convolution的性质可知：</p><ol><li>$\mu \star I = \epsilon$</li><li>$\varphi \star I = id$</li><li>$\mu \star id = \varphi$</li></ol><p>设现在要求 multiplicative function $f$ 的前缀和，设 $\sum_{i=1}^n f(i) = S(n)$ 。</p><p>再考虑另一个 multiplicative function $g$，考虑他们 Dirichlet convolution 的前缀和， $$\begin{split} \sum_{i=1}^n(f \star g)(i) &amp; = \sum_{i=1}^n\sum_{d|i}f(d)g(\frac{i}{d}) \\ &amp; = \sum_{d=1}^ng(d)\sum_{i=1}^{n/d}f(i) \\ &amp; = \sum_{d=1}^ng(d)S(n/d) \\ \end{split}$$</p><p>接着考虑 $g(1)S(n)$ 等于什么。</p><p>可以发现， $$g(1)S(n) = \sum_{i=1}^ng(i)S(\frac{n}{i}) - \sum_{i=2}^ng(i)S(\frac{n}{i})$$</p><p>而 $\sum_{i=1}^ng(i)S(\frac{n}{i}) = \sum_{i=1}^n(f \star g)(i)$，所以得到<strong>杜教筛</strong>的核心式子，</p><p>$$g(1)S(n) = \sum_{i=1}^n(f \star g)(i) - \sum_{i=2}^nf(i)S(\frac{n}{i})$$</p><p>现在如果我们可以找到一个合适的 multiplicative function $g$，使得可以快速算出 $\sum_{i=1}^n(f \star g)(i)$ 和 $g$ 的前缀和，便可以用数论分块递归地求解。</p><p>代码大体框架如下：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">ll <span class="title">GetSum</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">    ll ans = <span class="built_in">f_g_sum</span>(n); <span class="comment">// The prefix sum of f * g</span></span><br><span class="line">    <span class="keyword">for</span> (ll l = <span class="number">2</span>, r; l &lt;= n; l = r + <span class="number">1</span>) &#123;</span><br><span class="line">        r = n / (n / l);</span><br><span class="line">        ans -= (<span class="built_in">g_sum</span>(r) - <span class="built_in">g_sum</span>(l - <span class="number">1</span>)) * <span class="built_in">GetSum</span>(n / l);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这个代码的复杂度是 $O(n^{\frac{3}{4}})$，若事先筛出前 $m$ 个答案，之后再用杜教筛，当 $m=n^{\frac{2}{3}}$ 时，复杂度为 $O(n^{\frac{2}{3}})$。</p><p>上述内容主要出自<a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/solution/P4213">这篇文章</a>。</p><h3 id="杜教筛">杜教筛</h3><p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P4213">Problem</a></p><p>Given $n$, find $\sum_{i=1}^n\varphi(i)$ and $\sum_{i=1}^n\mu(i)$, where $n &lt; 2^{31}$.</p><p>首先对 $\mu$ 求前缀和，因为 $\mu \star I = \epsilon$，所以令 $f(n) = \mu(n)$，$g(n) = I(n) = 1$，则 $\sum_{i=1}^n(f \star g)(i) = 1$， $\sum_{i=1}^ng(i) = n$。</p><p>然后对 $\varphi$ 求前缀和，因为 $\varphi \star I = id$，所以令 $f(n) = \varphi(n)$，$g(n) = I(n) = 1$，则 $\sum_{i=1}^n(f \star g)(i) = \frac{n\cdot(n+1)}{2}$，$\sum_{i=1}^ng(i) = n$。</p><p>然后使用上面提到的方法即可。</p><details><summary><u style="color:Tomato"><b>Solution</b></u></summary><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> all(x) x.begin(),x.end()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> pb push_back</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> tc int tt, qq = 0; cin &gt;&gt; tt; while(qq++ &lt; tt)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> cs cout &lt;&lt; <span class="string">&quot;Case &quot;</span> &lt;&lt; qq &lt;&lt; <span class="string">&quot;: &quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> INF 1000000000000000000LL <span class="comment">// Never use 1e(s) mara khawa sure, mone rakhba :)</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> speed ios_base::sync_with_stdio(0); cin.tie(0); cout.tie(0);</span></span><br><span class="line"><span class="function">mt19937_64 <span class="title">rng</span><span class="params">(chrono::steady_clock::now().time_since_epoch().count())</span></span>;</span><br><span class="line"><span class="keyword">using</span> <span class="type">hash_t</span> = <span class="type">uint64_t</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">2000004</span>;</span><br><span class="line"><span class="type">int</span> phi[N], mu[N], mind[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">precompute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">signed</span> i = <span class="number">1</span>; i &lt; N; i++) phi[i] = i, mu[i] = <span class="number">-1</span>, mind[i] = i;</span><br><span class="line">    mu[<span class="number">1</span>] = mind[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">signed</span> i = <span class="number">2</span>; i &lt; N; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (mind[i] == i) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">signed</span> j = i; j &lt;= N; j += i) &#123;</span><br><span class="line">                <span class="keyword">if</span> (mind[j] == j) mind[j] = i;</span><br><span class="line">                phi[j] = phi[j]  - phi[j] / i;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (mind[i / mind[i]] == mind[i]) mu[i] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">else</span> mu[i] = mu[i / mind[i]] * mu[mind[i]];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt; N; i++) &#123;</span><br><span class="line">        mu[i] += mu[i<span class="number">-1</span>];</span><br><span class="line">        phi[i] += phi[i<span class="number">-1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">unordered_map&lt;<span class="type">int</span>, <span class="type">int</span>&gt; ans_phi, ans_mu;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">get_phi</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (n &lt; N) <span class="keyword">return</span> phi[n];</span><br><span class="line">    <span class="keyword">if</span> (ans_phi.<span class="built_in">count</span>(n)) <span class="keyword">return</span> ans_phi[n];</span><br><span class="line">    <span class="type">int</span> ans = n * (n + <span class="number">1</span>) / <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> l = <span class="number">2</span>, r; l &lt;= n; l = r + <span class="number">1</span>) &#123;</span><br><span class="line">        r = n / (n / l);</span><br><span class="line">        ans -= (r - l + <span class="number">1</span>) * <span class="built_in">get_phi</span>(n / l);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans_phi[n] = ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">get_mu</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (n &lt; N) <span class="keyword">return</span> mu[n];</span><br><span class="line">    <span class="keyword">if</span> (ans_mu.<span class="built_in">count</span>(n)) <span class="keyword">return</span> ans_mu[n];</span><br><span class="line">    <span class="type">int</span> ans = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> l = <span class="number">2</span>, r; l &lt;= n; l = r + <span class="number">1</span>) &#123;</span><br><span class="line">        r = n / (n / l);</span><br><span class="line">        ans -= <span class="built_in">get_mu</span>(n / l) * (r - l + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans_mu[n] = ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> n; cin &gt;&gt; n;</span><br><span class="line">    cout &lt;&lt; <span class="built_in">get_phi</span>(n) &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; <span class="built_in">get_mu</span>(n) &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">speed</span></span><br><span class="line"><span class="function">    <span class="title">precompute</span><span class="params">()</span></span>;</span><br><span class="line">    tc &#123;</span><br><span class="line">        <span class="built_in">solve</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></details><h3 id="function">function</h3><p><a target="_blank" rel="noopener" href="https://acm.hdu.edu.cn/showproblem.php?pid=5608">Problem</a></p><p>Given function $f(x)$ which satisfies $N^2-3N+2 = \sum_{d|N}f(d)$，find $\sum_{i=1}^n f(i)$.</p><p>令 $g = I$，则， $$\sum_{i=1}^n (f \star g)(i) = \sum_{i=1}^n \sum_{d|i}f(d)g(\frac{i}{d}) = \sum_{i=1}^n \sum_{d|i}f(d)$$</p><p>因为我们有 $\sum_{d|i}f(d) = i^2-3i+2，所以， $$\sum_{i=1}^n (f \star g)(i) = \sum_{i=1}^n i^2-3i+2 = \sum_{i=1}^n i^2 - 3\sum_{i=1}^n i + \sum_{i=1}^n 2$$</p><p>其中, $$\begin{split} \sum_{i=1}^n i^2 &amp; = \frac{n(n+1)(2n+1)}{6} \\ \sum_{i=1}^n i &amp; = \frac{n(n+1)}{2} \\ \sum_{i=1}^n 2 &amp; = 2n \\ \end{split}$$</p><p>所以 $\sum_{i=1}^n (f \star g)(i) = \frac{n(n+1)(2n+1)}{6} - 3\frac{n(n+1)}{2} + 2n = \frac{n(n-2)(n-1)}{3}$。故得解。</p><p>为了降低总复杂度，当 $n$ 比较小的时候，我们要提前算出其前缀和。 $$ h(n) = n^2 - 3n + 2 = \sum_{d|n}f(d)$$</p><p>根据 Mobius inversion，我们有 $$ f(n) = \sum_{d|n}\mu(d)h(\frac{n}{d}) $$</p><p>这样就可以提前通过筛法求出 $\sum_{i=1}^n f(i)$ 的值了。</p><details><summary><u style="color:Tomato"><b>Solution</b></u></summary><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> all(x) x.begin(),x.end()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> pb push_back</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> tc int tt, qq = 0; cin &gt;&gt; tt; while(qq++ &lt; tt)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> cs cout &lt;&lt; <span class="string">&quot;Case &quot;</span> &lt;&lt; qq &lt;&lt; <span class="string">&quot;: &quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> INF 1000000000000000000LL <span class="comment">// Never use 1e(s) mara khawa sure, mone rakhba :)</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> speed ios_base::sync_with_stdio(0); cin.tie(0); cout.tie(0);</span></span><br><span class="line"><span class="function">mt19937_64 <span class="title">rng</span><span class="params">(chrono::steady_clock::now().time_since_epoch().count())</span></span>;</span><br><span class="line"><span class="keyword">using</span> <span class="type">hash_t</span> = <span class="type">uint64_t</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1000004</span>, MOD = <span class="number">1000000007</span>;</span><br><span class="line"><span class="type">int</span> mu[N], mind[N], f[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">bigpow</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (n == <span class="number">0</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> b = <span class="built_in">bigpow</span>(a, n / <span class="number">2</span>);</span><br><span class="line">    b = b * b % MOD;</span><br><span class="line">    <span class="keyword">if</span> (n % <span class="number">2</span> == <span class="number">1</span>) b = b * a % MOD;</span><br><span class="line">    <span class="keyword">return</span> b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">inv</span><span class="params">(<span class="type">int</span> a)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bigpow</span>(a, MOD - <span class="number">2</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">h</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (n - <span class="number">2</span>) * (n - <span class="number">1</span>) % MOD;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">precompute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; N; i++) mu[i] = MOD - <span class="number">1</span>, mind[i] = <span class="number">-1</span>;</span><br><span class="line">    mu[<span class="number">1</span>] = mind[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt; N; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (mind[i] == <span class="number">-1</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = i; j &lt; N; j += i) &#123;</span><br><span class="line">                <span class="keyword">if</span> (mind[j] == <span class="number">-1</span>) mind[j] = i;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (mind[i / mind[i]] == mind[i]) mu[i] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">else</span> mu[i] = mu[i / mind[i]] * mu[mind[i]] % MOD;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; N; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = i; j &lt; N; j += i) &#123;</span><br><span class="line">            f[j] = (f[j] + mu[i] * <span class="built_in">h</span>(j / i) % MOD) % MOD;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; N; i++) &#123;</span><br><span class="line">        f[i] = (f[i] + f[i - <span class="number">1</span>]) % MOD;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">unordered_map&lt;<span class="type">int</span>, <span class="type">int</span>&gt; ss;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">sum_s</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (n &lt; N) <span class="keyword">return</span> f[n];</span><br><span class="line">    <span class="keyword">if</span> (ss.<span class="built_in">count</span>(n)) <span class="keyword">return</span> ss[n];</span><br><span class="line">    <span class="type">int</span> a = n * (<span class="number">2</span> * n + <span class="number">1</span>) % MOD * (n + <span class="number">1</span>) % MOD * <span class="built_in">inv</span>(<span class="number">6</span>) % MOD;</span><br><span class="line">    <span class="type">int</span> b = <span class="number">3</span> * n % MOD * (n + <span class="number">1</span>) % MOD * <span class="built_in">inv</span>(<span class="number">2</span>) % MOD;</span><br><span class="line">    <span class="type">int</span> c = <span class="number">2</span> * n % MOD;</span><br><span class="line">    <span class="type">int</span> ans = ((a - b + MOD) % MOD + c) % MOD;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> l = <span class="number">2</span>, r; l &lt;= n; l = r + <span class="number">1</span>) &#123;</span><br><span class="line">        r = n / (n / l);</span><br><span class="line">        ans = (ans - (r - l + <span class="number">1</span>) * <span class="built_in">sum_s</span>(n / l) % MOD + MOD) % MOD;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ss[n] = ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> n; cin &gt;&gt; n;</span><br><span class="line">    cout &lt;&lt; <span class="built_in">sum_s</span>(n) &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">speed</span></span><br><span class="line"><span class="function">    <span class="title">precompute</span><span class="params">()</span></span>;</span><br><span class="line">    tc &#123;</span><br><span class="line">        <span class="built_in">solve</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></details><h3 id="adding-least-common-multiples">Adding Least Common Multiples</h3><p><a target="_blank" rel="noopener" href="https://www.codechef.com/problems/LCM?tab=statement">Problem</a></p><p>Given $A$ and $B$, find $\sum_{a=1}^A\sum_{b=1}^Blcm(a, b)$，and there&#39;s no integer $n &gt; 1$ such that $n^2$ divides both $a$ and $b$.</p><p>Assume throughout that $A &lt;= B$. We want to compute $\sum_{a=1}^A\sum_{b=1}^BabF(gcd(a, b))$, where $F(n) = \frac{1}{n}$ if n is square-free, and $0$ otherwise. Adapting a standard approach, we do the following:</p><p>Let $f(n) = \sum_{d|n}\mu(d)F(d)$. Then $F(n) = \sum_{d|n}f(d)$.</p><p>$$\begin{split} &amp; \sum_{a=1}^A\sum_{b=1}^BabF(gcd(a, b)) \\ &amp; = \sum_{a=1}^A\sum_{b=1}^Bab\sum_{d|gcd(a, b)}f(d) \\ &amp; = \sum_{d=1}^Af(d)\sum_{i=1}^{A/d}\sum_{i=1}^{B/d}(id)(jd)f(d) \\ &amp; = \sum_{d=1}^Ad^2f(d)\sum_{i=1}^{A/d}i\sum_{j=1}^{B/d}j \\ &amp; = \sum_{d=1}^Ad^2f(d)\binom{\frac{A}{d} + 1}{2}\binom{\frac{B}{d} + 1}{2} \\ &amp; = \frac{1}{4}\sum_{d=1}^Ad^2f(d)(\frac{A}{d} + 1)\frac{A}{d}(\frac{B}{d} + 1)\frac{B}{d} \\ \end{split}$$</p><p>For any $n &gt;= 1$, we have $f(n) = \sum_{d|n}\mu(d)F(\frac{n}{d}) = \frac{1}{n}\sum_{d|n}\mu(d)d\mu^2(\frac{n}{d})$.</p><p><strong>$\mu^2(k) = 1$ iff k is square-free</strong>.</p><p>Since $F$ is multiplicative, so is $f$. Using this is easy to find $f$. If $n$ is divisible by $p^3$ for some prime $p$, then $f(n) = 0$. Because either $p^2$ is in $d$ so $\mu(d) = 0$, or in $\frac{n}{d}$ so $\mu^2(\frac{n}{d}) = 0$.</p><p>Otherwise, $n=p_1^2p_2^2 \cdots p_s^2q_1q_2 \cdots q_t$, $f(n) = \frac{1}{n}\prod_{i=1}^sf(p_i^2)\prod_{j=1}^sf(q_j)$.</p><p>Let $h(d) = \mu(d)d\mu^2(\frac{n}{d})$ and $g(n) = \sum_{d|n}h(d) = \prod_{i=1}^sg(p_i^2)\prod_{j=1}^sg(q_j)$. Then, $g(p_i^2) = h(1) + h(p_i) + h(p_i^2) = 0 - p_i + 0 = -p_i$, and $g(q_j) = h(1) + h(q_j) = 1 - q_j$.</p><p>So we have $g(n) = \prod_{i=1}^s(-p_i)\prod_{j=1}^t(1-q_j)$. That is: start with 1, for each prime $p$ such that $p$ divides n but $p^2$ does not, multiply by $1 - p$. For each prime $p$ such that $p$ divides $n$ and $p^2$ also divides $n$, multiply by $-p$. If $p^3$ divides $n$, then $g(n) = 0$.</p><p>So we can precompute $g$, and futher use it to compute the answer.</p><details><summary><u style="color:Tomato"><b>Solution</b></u></summary><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">using namespace std;</span><br><span class="line">#define int unsigned</span><br><span class="line">#define all(x) x.begin(),x.end()</span><br><span class="line">#define pb push_back</span><br><span class="line">#define tc int tt, qq = 0; cin &gt;&gt; tt; while(qq++ &lt; tt)</span><br><span class="line">#define cs cout &lt;&lt; &quot;Case &quot; &lt;&lt; qq &lt;&lt; &quot;: &quot;</span><br><span class="line">#define INF 1000000000000000000LL // Never use 1e(s) mara khawa sure, mone rakhba :)</span><br><span class="line">#define speed ios_base::sync_with_stdio(0); cin.tie(0); cout.tie(0);</span><br><span class="line">mt19937_64 rng(chrono::steady_clock::now().time_since_epoch().count());</span><br><span class="line">using hash_t = uint64_t;</span><br><span class="line"></span><br><span class="line">const int MASK = (1 &lt;&lt; 30) - 1;</span><br><span class="line">const int N = 4000000 + 1;</span><br><span class="line">int mu[N], mind[N], g[N], pref[N];</span><br><span class="line"></span><br><span class="line">void precompute() &#123;</span><br><span class="line">    for (int i = 1; i &lt; N; i++) mu[i] = -1, mind[i] = -1, g[i] = 1, pref[i] = 0;</span><br><span class="line">    mu[1] = mind[1] = pref[1] = 1;</span><br><span class="line">    for (int i = 2; i &lt; N; i++) &#123;</span><br><span class="line">        if (mind[i] == -1) &#123;</span><br><span class="line">            for (int j = i; j &lt; N; j += i) &#123;</span><br><span class="line">                if (mind[j] == -1) mind[j] = i;</span><br><span class="line">                if (j / i % i == 0) g[j] = (g[j] * (- i));</span><br><span class="line">                else g[j] = g[j] * (1 - i);</span><br><span class="line"></span><br><span class="line">                if (j % (i * i) == 0 &amp;&amp; j / i / i % i == 0) g[j] = 0;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        if (mind[i] == i) mu[i] = - 1;</span><br><span class="line">        else if (mind[i / mind[i]] == mind[i]) mu[i] = 0;</span><br><span class="line">        else mu[i] = mu[i / mind[i]] * mu[mind[i]];</span><br><span class="line"></span><br><span class="line">        pref[i] = pref[i-1] + g[i] * i;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void solve() &#123;</span><br><span class="line">    int A, B; cin &gt;&gt; A &gt;&gt; B;</span><br><span class="line">    if (A &gt; B) swap(A, B);</span><br><span class="line">    int ans = 0;</span><br><span class="line">    int r;</span><br><span class="line">    for (int l = 1, nxt; l &lt;= min(A, B); l = r + 1) &#123;</span><br><span class="line">        int ra = A/(A/l), rb = B/(B/l);</span><br><span class="line">        int a = A / l, b = B / l;</span><br><span class="line">        r = min(ra, rb);</span><br><span class="line">        int v = (a + 1) * a / 2;</span><br><span class="line">        v *= (b + 1) * b / 2;</span><br><span class="line">        v *= pref[r] - pref[l - 1];</span><br><span class="line">        ans = ans + v;</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; A &lt;&lt; &quot; &quot; &lt;&lt; B &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; (ans &amp; MASK) &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">signed main() &#123;</span><br><span class="line">    speed</span><br><span class="line">    precompute();</span><br><span class="line">    tc &#123;</span><br><span class="line">        solve();</span><br><span class="line">    &#125;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></details><h2 id="more-advanced-problems">More advanced problems</h2><p>还有一些高级的题目，涉及到对 Dirichlet convolution 的更深入的分析。我就没有继续往下做了。这里列举2个供需要的人取用。</p><ul><li><a target="_blank" rel="noopener" href="https://www.spoj.com/problems/GCDEX2/">GCDEX2</a></li><li><a target="_blank" rel="noopener" href="https://www.spoj.com/problems/DIVCNT2/">DIVCNT2 - Counting Divisors (square)</a></li></ul></div></div></article><section id="comments"><div id="disqus_thread"></div><script>var disqus_config=function(){this.page.url="https://andimeo.us.kg/2024/12/09/Mobius-inversion/",this.page.identifier="44bd7b20-b642-11ef-bd64-b3fdfd8f89c7"};!function(){var e=document,t=e.createElement("script");t.src="https://andimeo.disqus.com/embed.js",t.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(t)}()</script><noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></section></section><aside id="sidebar"><div class="widget-wrap center"><ul class="pagination"><li><span class="nav-prev disabled">Prev</span></li><li><a data-url="https://andimeo.us.kg/2024/12/09/Mobius-inversion/" data-id="cm5521umq000l0wy73853g1h6" data_title="Möbius inversion" data_summary="从哪里发现的这个东西我都已经忘了，已经折腾了半个月了。今天写个总结。
Mobius inversion是一个有关 arithmetic function, multiplicative function 的定理。可以参阅 Be..." class="article-share-link">Share</a></li><li><a href="/2024/11/03/1到n的异或和/" class="nav-next">Next</a></li></ul></div><div class="widget-wrap"><div class="post-widget"><i class="fa fa-clock-o"></i> <time datetime="2024-12-09T15:28:40.000Z" itemprop="datePublished">2024-12-09</time></div></div><div class="widget-wrap"><div class="post-widget"><i class="fa fa-folder"></i> <a class="category-link" href="/categories/Algorithm/">Algorithm<span class="category-count">4</span></a></div></div><div class="widget-wrap"><div class="post-widget"><i class="fa fa-tags"></i> <a class="tag-none-link" href="/tags/Dirichlet-Convolution/" rel="tag">Dirichlet Convolution<span class="tag-none-count">1</span></a><a class="tag-none-link" href="/tags/Math/" rel="tag">Math<span class="tag-none-count">1</span></a><a class="tag-none-link" href="/tags/Mobius-Inversion/" rel="tag">Mobius Inversion<span class="tag-none-count">1</span></a><a class="tag-none-link" href="/tags/Number-Theory/" rel="tag">Number Theory<span class="tag-none-count">1</span></a></div></div></aside></div><footer id="footer"><div class="outer container"><div id="footer-info" class="inner"><a href="/">Andimeo&#39;s Blog</a> &copy; 2024 Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and Theme by <a href="https://github.com/Andimeo/hexo-theme-nut" target="_blank">Nut</a></div></div></footer><a id="gotop" href="#"><i class="fa fa-chevron-up"></i></a></div><nav id="mobile-nav"><a href="[object Object]" class="mobile-nav-link">0</a> <a href="[object Object]" class="mobile-nav-link">1</a> <a href="[object Object]" class="mobile-nav-link">2</a> <a href="[object Object]" class="mobile-nav-link">3</a></nav><script src="/js/jquery.min.js"></script><link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css"><script src="/fancybox/jquery.fancybox.pack.js"></script><script src="/js/jquery.fitvids.js"></script><script src="/js/bootstrap.min.js"></script><script src="/js/script.js"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX", "output/HTML-CSS"],
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
      processEscapes: true
    },
    "HTML-CSS": { fonts: ["TeX"] }
  });</script><script type="text/javascript" src="/js/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script id="dsq-count-scr" src="//andimeo.disqus.com/count.js" async></script></div></body></html>